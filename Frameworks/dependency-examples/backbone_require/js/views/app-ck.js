define(["jquery","underscore","backbone","collections/todos","views/todos","text!templates/stats.html","common"],function(e,t,n,r,i,s,o){var u=n.View.extend({el:"#todoapp",template:t.template(s),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.input=this.$("#new-todo");this.allCheckbox=this.$("#toggle-all")[0];this.$footer=this.$("#footer");this.$main=this.$("#main");r.on("add",this.addAll,this);r.on("reset",this.addAll,this);r.on("change:completed",this.addAll,this);r.on("all",this.render,this);r.fetch()},render:function(){var e=r.completed().length,t=r.remaining().length;if(r.length){this.$main.show();this.$footer.show();this.$footer.html(this.template({completed:e,remaining:t}));this.$("#filters li a").removeClass("selected").filter('[href="#/'+(o.TodoFilter||"")+'"]').addClass("selected")}else{this.$main.hide();this.$footer.hide()}this.allCheckbox.checked=!t},addOne:function(t){var n=new i({model:t});e("#todo-list").append(n.render().el)},addAll:function(){this.$("#todo-list").html("");switch(o.TodoFilter){case"active":t.each(r.remaining(),this.addOne);break;case"completed":t.each(r.completed(),this.addOne);break;default:r.each(this.addOne,this)}},newAttributes:function(){return{title:this.input.val().trim(),order:r.nextOrder(),completed:!1}},createOnEnter:function(e){if(e.which!==o.ENTER_KEY||!this.input.val().trim())return;r.create(this.newAttributes());this.input.val("")},clearCompleted:function(){t.each(r.completed(),function(e){e.destroy()});return!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;r.each(function(t){t.save({completed:e})})}});return u});