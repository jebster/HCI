(function(){var e,t,n,r,i,s=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);n.prototype=t.prototype;e.prototype=new n;e.__super__=t.prototype;return e},u=Array.prototype.slice;if("undefined"==typeof Spine||null===Spine)Spine=require("spine");e=Spine.$;n=/^#*/;r=/:([\w\d]+)/g;i=/\*([\w\d]+)/g;t=/[-[\]{}()+?.,\\^$|#\s]/g;Spine.Route=function(s){function a(e,n){var s;this.path=e;this.callback=n;this.names=[];if("string"==typeof e){for(r.lastIndex=0;null!==(s=r.exec(e));)this.names.push(s[1]);e=e.replace(t,"\\$&").replace(r,"([^/]*)").replace(i,"(.*?)");this.route=RegExp("^"+e+"$")}else this.route=e}var l;o(a,s);a.extend(Spine.Events);a.historySupport=null!=(null!=(l=window.history)?l.pushState:void 0);a.routes=[];a.options={trigger:!0,history:!1,shim:!1};a.add=function(e,t){var n,r,i;if("object"!=typeof e||e instanceof RegExp)return this.routes.push(new this(e,t));i=[];for(n in e)r=e[n],i.push(this.add(n,r));return i};a.setup=function(t){null==t&&(t={});this.options=e.extend({},this.options,t);this.options.history&&(this.history=this.historySupport&&this.options.history);if(!this.options.shim)return this.history?e(window).bind("popstate",this.change):e(window).bind("hashchange",this.change),this.change()};a.unbind=function(){return this.history?e(window).unbind("popstate",this.change):e(window).unbind("hashchange",this.change)};a.navigate=function(){var t,n,r;t=1<=arguments.length?u.call(arguments,0):[];r={};n=t[t.length-1];"object"==typeof n?r=t.pop():"boolean"==typeof n&&(r.trigger=t.pop());r=e.extend({},this.options,r);t=t.join("/");if(this.path!==t&&(this.path=t,this.trigger("navigate",this.path),r.trigger&&this.matchRoute(this.path,r),!r.shim))return this.history?history.pushState({},document.title,this.path):window.location.hash=this.path};a.getPath=function(){var e;e=window.location.pathname;"/"!==e.substr(0,1)&&(e="/"+e);return e};a.getHash=function(){return window.location.hash};a.getFragment=function(){return this.getHash().replace(n,"")};a.getHost=function(){return(document.location+"").replace(this.getPath()+this.getHash(),"")};a.change=function(){var e;e=""!==this.getFragment()?this.getFragment():this.getPath();if(e!==this.path)return this.path=e,this.matchRoute(this.path)};a.matchRoute=function(e,t){var n,r,i,s;s=this.routes;r=0;for(i=s.length;r<i;r++)if(n=s[r],n.match(e,t))return this.trigger("change",n,e),n};a.prototype.match=function(e,t){var n,r,i,s;null==t&&(t={});n=this.route.exec(e);if(!n)return!1;t.match=n;i=n.slice(1);if(this.names.length){n=0;for(s=i.length;n<s;n++)r=i[n],t[this.names[n]]=r}return!1!==this.callback.call(null,t)};return a}(Spine.Module);Spine.Route.change=Spine.Route.proxy(Spine.Route.change);Spine.Controller.include({route:function(e,t){return Spine.Route.add(e,this.proxy(t))},routes:function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.route(t,n));return r},navigate:function(){return Spine.Route.navigate.apply(Spine.Route,arguments)}});"undefined"!=typeof module&&null!==module&&(module.exports=Spine.Route)}).call(this);