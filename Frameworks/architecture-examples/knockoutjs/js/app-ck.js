/*global ko, crossroads */(function(){"use strict";var e=13;ko.bindingHandlers.enterKey={init:function(t,n,r,i){var s,o;s=function(t,r){r.keyCode===e&&n().call(this,t,r)};o=function(){return{keyup:s}};ko.bindingHandlers.event.init(t,o,r,i)}};ko.bindingHandlers.selectAndFocus={init:function(e,t,n){ko.bindingHandlers.hasfocus.init(e,t,n);ko.utils.registerEventHandler(e,"focus",function(){e.focus()})},update:function(e,t){ko.utils.unwrapObservable(t());setTimeout(function(){ko.bindingHandlers.hasfocus.update(e,t)},0)}};var t=function(e,t){this.title=ko.observable(e);this.completed=ko.observable(t);this.editing=ko.observable(!1)},n=function(e){var n=this;n.todos=ko.observableArray(ko.utils.arrayMap(e,function(e){return new t(e.title,e.completed)}));n.current=ko.observable();n.showMode=ko.observable("all");n.filteredTodos=ko.computed(function(){switch(n.showMode()){case"active":return n.todos().filter(function(e){return!e.completed()});case"completed":return n.todos().filter(function(e){return e.completed()});default:return n.todos()}});n.add=function(){var e=n.current().trim();if(e){n.todos.push(new t(e));n.current("")}};n.remove=function(e){n.todos.remove(e)};n.removeCompleted=function(){n.todos.remove(function(e){return e.completed()})};n.editItem=function(e){e.editing(!0)};n.stopEditing=function(e){e.editing(!1);e.title().trim()||n.remove(e)};n.completedCount=ko.computed(function(){return ko.utils.arrayFilter(n.todos(),function(e){return e.completed()}).length});n.remainingCount=ko.computed(function(){return n.todos().length-n.completedCount()});n.allCompleted=ko.computed({read:function(){return!n.remainingCount()},write:function(e){ko.utils.arrayForEach(n.todos(),function(t){t.completed(e)})}});n.getLabel=function(e){return ko.utils.unwrapObservable(e)===1?"item":"items"};ko.computed(function(){localStorage.setItem("todos-knockout",ko.toJSON(n.todos))}).extend({throttle:500})},r=ko.utils.parseJson(localStorage.getItem("todos-knockout")),i=new n(r||[]);ko.applyBindings(i);crossroads.addRoute("all",function(){i.showMode("all")});crossroads.addRoute("active",function(){i.showMode("active")});crossroads.addRoute("completed",function(){i.showMode("completed")});window.onhashchange=function(){crossroads.parse(location.hash.replace("#",""))};crossroads.parse(location.hash.replace("#",""))})();