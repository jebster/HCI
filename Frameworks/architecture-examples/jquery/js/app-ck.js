/*global jQuery, Handlebars */jQuery(function(e){"use strict";var t={uuid:function(e,t){for(t=e="";e++<36;t+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return t},pluralize:function(e,t){return e===1?t:t+"s"},store:function(e,t){if(arguments.length>1)return localStorage.setItem(e,JSON.stringify(t));var n=localStorage.getItem(e);return n&&JSON.parse(n)||[]}},n={init:function(){this.ENTER_KEY=13;this.todos=t.store("todos-jquery");this.cacheElements();this.bindEvents();this.render()},cacheElements:function(){this.todoTemplate=Handlebars.compile(e("#todo-template").html());this.footerTemplate=Handlebars.compile(e("#footer-template").html());this.$todoApp=e("#todoapp");this.$newTodo=e("#new-todo");this.$toggleAll=e("#toggle-all");this.$main=e("#main");this.$todoList=e("#todo-list");this.$footer=this.$todoApp.find("#footer");this.$count=e("#todo-count");this.$clearBtn=e("#clear-completed")},bindEvents:function(){var e=this.$todoList;this.$newTodo.on("keyup",this.create);this.$toggleAll.on("change",this.toggleAll);this.$footer.on("click","#clear-completed",this.destroyCompleted);e.on("change",".toggle",this.toggle);e.on("dblclick","label",this.edit);e.on("keypress",".edit",this.blurOnEnter);e.on("blur",".edit",this.update);e.on("click",".destroy",this.destroy)},render:function(){this.$todoList.html(this.todoTemplate(this.todos));this.$main.toggle(!!this.todos.length);this.$toggleAll.prop("checked",!this.activeTodoCount());this.renderFooter();t.store("todos-jquery",this.todos)},renderFooter:function(){var e=this.todos.length,n=this.activeTodoCount(),r={activeTodoCount:n,activeTodoWord:t.pluralize(n,"item"),completedTodos:e-n};this.$footer.toggle(!!e);this.$footer.html(this.footerTemplate(r))},toggleAll:function(){var t=e(this).prop("checked");e.each(n.todos,function(e,n){n.completed=t});n.render()},activeTodoCount:function(){var t=0;e.each(this.todos,function(e,n){n.completed||t++});return t},destroyCompleted:function(){var e=n.todos,t=e.length;while(t--)e[t].completed&&e.splice(t,1);n.render()},getTodo:function(t,r){var i=e(t).closest("li").data("id");e.each(this.todos,function(e,t){if(t.id===i){r.apply(n,arguments);return!1}})},create:function(r){var i=e(this),s=e.trim(i.val());if(r.which!==n.ENTER_KEY||!s)return;n.todos.push({id:t.uuid(),title:s,completed:!1});i.val("");n.render()},toggle:function(){n.getTodo(this,function(e,t){t.completed=!t.completed});n.render()},edit:function(){e(this).closest("li").addClass("editing").find(".edit").focus()},blurOnEnter:function(e){e.keyCode===n.ENTER_KEY&&e.target.blur()},update:function(){var t=e.trim(e(this).removeClass("editing").val());n.getTodo(this,function(e){t?this.todos[e].title=t:this.todos.splice(e,1);this.render()})},destroy:function(){n.getTodo(this,function(e){this.todos.splice(e,1);this.render()})}};n.init()});