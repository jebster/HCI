(function(){Todo=can.Model({localStore:function(e){var t="todos-canjs-jquery",n=JSON.parse(window.localStorage[t]||(window.localStorage[t]="[]")),r=e.call(this,n);if(r!==!1){can.each(n,function(e){delete e.editing});window.localStorage[t]=JSON.stringify(n)}},findAll:function(e){var t=new can.Deferred;this.localStore(function(e){var n=[],r=this;can.each(e,function(e){n.push(new r(e))});t.resolve({data:n})});return t},destroy:function(e){var t=new can.Deferred;this.localStore(function(n){for(var r=0;r<n.length;r++)if(n[r].id===e){n.splice(r,1);break}t.resolve({})});return t},create:function(e){var t=new can.Deferred;this.localStore(function(t){e.id=e.id||parseInt(1e5*Math.random(),10);t.push(e)});t.resolve({id:e.id});return t},update:function(e,t){var n=new can.Deferred,r;this.localStore(function(n){for(var i=0;i<n.length;i++)if(n[i].id===e){r=n[i];break}can.extend(r,t)});n.resolve({});return n}},{});Todo.List=can.Model.List({completed:function(){this.attr("length");var e=0;this.each(function(t){e+=t.attr("complete")?1:0});return e},remaining:function(){return this.attr("length")-this.completed()},allComplete:function(){return this.attr("length")===this.completed()}});Todos=can.Control({init:function(){this.element.append(can.view("todo",{todos:this.options.todos}));$("#new-todo").val("").focus()},"#new-todo keyup":function(e,t){t.keyCode==13&&(new Todo({text:e.val(),complete:!1})).save(function(){e.val("")})},"{Todo} created":function(e,t,n){this.options.todos.push(n)},".todo dblclick":function(e,t){e.data("todo").attr("editing",!0).save(function(){e.children(".edit").focus()})},updateTodo:function(e){e.closest(".todo").data("todo").attr({editing:!1,text:e.val()}).save()},".todo .edit keyup":function(e,t){t.keyCode==13&&this.updateTodo(e)},".todo .edit focusout":function(e,t){this.updateTodo(e)},".todo .toggle click":function(e,t){e.closest(".todo").data("todo").attr("complete",e.is(":checked")).save()},".todo .destroy click":function(e){e.closest(".todo").data("todo").destroy()},"#toggle-all click":function(e,t){var n=e.prop("checked");can.each(this.options.todos,function(e){e.attr("complete",n).save()})},"#clear-completed click":function(){for(var e=this.options.todos.length-1,t;e>-1&&(t=this.options.todos[e]);e--)t.attr("complete")&&t.destroy()}});Todo.findAll({},function(e){new Todos("#todoapp",{todos:e})})})();