(function(){var e,t=[].slice;e=function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(e.Object,n,function(){})},e.version="0.10.0",e.config={pathPrefix:"/",usePushState:!1,minificationErrors:!0},(e.container=function(){return this}()).Batman=e,typeof define=="function"&&define("batman",[],function(){return e}),e.exportHelpers=function(t){var n,r,i,s;s=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"];for(r=0,i=s.length;r<i;r++)n=s[r],t["$"+n]=e[n];return t},e.exportGlobals=function(){return e.exportHelpers(e.container)}}).call(this),function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Batman.Inflector=function(){function n(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return n.prototype.plural=function(e,t){return this._plural.unshift([e,t])},n.prototype.singular=function(e,t){return this._singular.unshift([e,t])},n.prototype.human=function(e,t){return this._human.unshift([e,t])},n.prototype.uncountable=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this._uncountable=this._uncountable.concat(t.map(function(e){return new RegExp(""+e+"$","i")}))},n.prototype.irregular=function(e,t){return e.charAt(0)===t.charAt(0)?(this.plural(new RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1)),this.plural(new RegExp("("+e.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+t.slice(1)),this.singular(new RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1))):(this.plural(new RegExp(""+e+"$","i"),t),this.plural(new RegExp(""+t+"$","i"),t),this.singular(new RegExp(""+t+"$","i"),e))},n.prototype.ordinalize=function(e){var n,r;n=Math.abs(parseInt(e));if(r=n%100,t.call([11,12,13],r)>=0)return e+"th";switch(n%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd";default:return e+"th"}},n.prototype.pluralize=function(e){var t,n,r,i,s,o,u,a,f,l;a=this._uncountable;for(i=0,o=a.length;i<o;i++){r=a[i];if(r.test(e))return e}f=this._plural;for(s=0,u=f.length;s<u;s++){l=f[s],t=l[0],n=l[1];if(t.test(e))return e.replace(t,n)}return e},n.prototype.singularize=function(e){var t,n,r,i,s,o,u,a,f,l;a=this._uncountable;for(i=0,o=a.length;i<o;i++){r=a[i];if(r.test(e))return e}f=this._singular;for(s=0,u=f.length;s<u;s++){l=f[s],t=l[0],n=l[1];if(t.test(e))return e.replace(t,n)}return e},n.prototype.humanize=function(e){var t,n,r,i,s,o;s=this._human;for(r=0,i=s.length;r<i;r++){o=s[r],t=o[0],n=o[1];if(t.test(e))return e.replace(t,n)}return e},n}()}.call(this),function(){var e,t,n,r,i,s,o,u;t=/(?:^|_|\-)(.)/g,n=/(^|\s)([a-z])/g,o=/([A-Z]+)([A-Z][a-z])/g,u=/([a-z\d])([A-Z])/g,r=/_id$/,i=/_|-/g,s=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(e,t,n,r){var i;return r==null&&(r=!0),arguments.length<2?Batman.helpers.inflector.pluralize(e):(i=+e===1?t:n||Batman.helpers.inflector.pluralize(t),r&&(i=""+(e||0)+" "+i),i)},camelize:function(e,n){return e=e.replace(t,function(e,t){return t.toUpperCase()}),n?e.substr(0,1).toLowerCase()+e.substr(1):e},underscore:function(e){return e.replace(o,"$1_$2").replace(u,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(e){return e.replace(n,function(e,t,n){return t+n.toUpperCase()})},trim:function(e){return e?e.trim():""},interpolate:function(e,t){var n,r,i;typeof e=="object"?(r=e[t.count],r||(r=e.other)):r=e;for(n in t)i=t[n],r=r.replace(new RegExp("%\\{"+n+"\\}","g"),i);return r},humanize:function(e){return e=Batman.helpers.underscore(e),e=Batman.helpers.inflector.humanize(e),e.replace(r,"").replace(i," ").replace(s,function(e){return e.toUpperCase()})}},e=new Batman.Inflector,Batman.helpers.inflector=e,e.plural(/$/,"s"),e.plural(/s$/i,"s"),e.plural(/(ax|test)is$/i,"$1es"),e.plural(/(octop|vir)us$/i,"$1i"),e.plural(/(octop|vir)i$/i,"$1i"),e.plural(/(alias|status)$/i,"$1es"),e.plural(/(bu)s$/i,"$1ses"),e.plural(/(buffal|tomat)o$/i,"$1oes"),e.plural(/([ti])um$/i,"$1a"),e.plural(/([ti])a$/i,"$1a"),e.plural(/sis$/i,"ses"),e.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),e.plural(/(hive)$/i,"$1s"),e.plural(/([^aeiouy]|qu)y$/i,"$1ies"),e.plural(/(x|ch|ss|sh)$/i,"$1es"),e.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),e.plural(/([m|l])ouse$/i,"$1ice"),e.plural(/([m|l])ice$/i,"$1ice"),e.plural(/^(ox)$/i,"$1en"),e.plural(/^(oxen)$/i,"$1"),e.plural(/(quiz)$/i,"$1zes"),e.singular(/s$/i,""),e.singular(/(n)ews$/i,"$1ews"),e.singular(/([ti])a$/i,"$1um"),e.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),e.singular(/(^analy)ses$/i,"$1sis"),e.singular(/([^f])ves$/i,"$1fe"),e.singular(/(hive)s$/i,"$1"),e.singular(/(tive)s$/i,"$1"),e.singular(/([lr])ves$/i,"$1f"),e.singular(/([^aeiouy]|qu)ies$/i,"$1y"),e.singular(/(s)eries$/i,"$1eries"),e.singular(/(m)ovies$/i,"$1ovie"),e.singular(/(x|ch|ss|sh)es$/i,"$1"),e.singular(/([m|l])ice$/i,"$1ouse"),e.singular(/(bus)es$/i,"$1"),e.singular(/(o)es$/i,"$1"),e.singular(/(shoe)s$/i,"$1"),e.singular(/(cris|ax|test)es$/i,"$1is"),e.singular(/(octop|vir)i$/i,"$1us"),e.singular(/(alias|status)es$/i,"$1"),e.singular(/^(ox)en/i,"$1"),e.singular(/(vert|ind)ices$/i,"$1ex"),e.singular(/(matr)ices$/i,"$1ix"),e.singular(/(quiz)zes$/i,"$1"),e.singular(/(database)s$/i,"$1"),e.irregular("person","people"),e.irregular("man","men"),e.irregular("child","children"),e.irregular("sex","sexes"),e.irregular("move","moves"),e.irregular("cow","kine"),e.irregular("zombie","zombies"),e.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var e,t,n=[].slice,r={}.hasOwnProperty,i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Batman.typeOf=function(e){return typeof e=="undefined"?"Undefined":t.call(e).slice(8,-1)},t=Object.prototype.toString,Batman.extend=function(){var e,t,r,i,s,o,u;i=arguments[0],r=2<=arguments.length?n.call(arguments,1):[];for(o=0,u=r.length;o<u;o++){t=r[o];for(e in t)s=t[e],i[e]=s}return i},Batman.mixin=function(){var e,t,i,s,o,u,a,f;o=arguments[0],s=2<=arguments.length?n.call(arguments,1):[],e=typeof o.set=="function";for(a=0,f=s.length;a<f;a++){i=s[a];if(Batman.typeOf(i)!=="Object")continue;for(t in i){if(!r.call(i,t))continue;u=i[t];if(t==="initialize"||t==="uninitialize"||t==="prototype")continue;e?o.set(t,u):o.nodeName!=null?Batman.data(o,t,u):o[t]=u}typeof i.initialize=="function"&&i.initialize.call(o)}return o},Batman.unmixin=function(){var e,t,r,i,s,o;e=arguments[0],i=2<=arguments.length?n.call(arguments,1):[];for(s=0,o=i.length;s<o;s++){r=i[s];for(t in r){if(t==="initialize"||t==="uninitialize")continue;delete e[t]}typeof r.uninitialize=="function"&&r.uninitialize.call(e)}return e},Batman._functionName=Batman.functionName=function(e){var t;return e.__name__?e.__name__:e.name?e.name:(t=e.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?t[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(e,t){var n;n=t.parentNode;while(n){if(n===e)return!0;n=n.parentNode}return!1},Batman.setImmediate=Batman.clearImmediate=null,e=function(e){var t,n,r,s,o,u,a;return t=function(){var t,n;return e.postMessage?(t=!0,n=e.onmessage,e.onmessage=function(){return t=!1},e.postMessage("","*"),e.onmessage=n,t):!1},a=new Batman.SimpleHash,n=0,s=function(){return"go"+ ++n},e.setImmediate?(Batman.setImmediate=e.setImmediate,Batman.clearImmediate=e.clearImmediate):e.msSetImmediate?(Batman.setImmediate=msSetImmediate,Batman.clearImmediate=msClearImmediate):t()?(u="com.batman.",r=new Batman.SimpleHash,o=function(e){var t,n;if(!~e.data.search(u))return;return t=e.data.substring(u.length),typeof (n=a.unset(t))=="function"?n():void 0},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),Batman.setImmediate=function(t){var n;return a.set(n=s(),t),e.postMessage(u+n,"*"),n},Batman.clearImmediate=function(e){return a.unset(e)}):typeof document!="undefined"&&i.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(e){var t,n;return t=s(),n=document.createElement("script"),n.onreadystatechange=function(){var e;return typeof (e=a.get(t))=="function"&&e(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},document.documentElement.appendChild(n),t},Batman.clearImmediate=function(e){return a.unset(e)}):(typeof process!="undefined"&&process!==null?process.nextTick:void 0)?(r={},Batman.setImmediate=function(e){var t;return t=s(),r[t]=e,process.nextTick(function(){return typeof r[t]=="function"&&r[t](),delete r[t]}),t},Batman.clearImmediate=function(e){return delete r[e]}):(Batman.setImmediate=function(e){return setTimeout(e,0)},Batman.clearImmediate=function(e){return clearTimeout(e)}),Batman.setImmediate=Batman.setImmediate,Batman.clearImmediate=Batman.clearImmediate},Batman.setImmediate=function(){return e(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return e(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(e,t,n){var r,i,s,o,u,a,f,l;if(e.forEach)return e.forEach(t,n);if(e.indexOf){f=[];for(i=u=0,a=e.length;u<a;i=++u)r=e[i],f.push(t.call(n,r,i,e));return f}l=[];for(s in e)o=e[s],l.push(t.call(n,s,o,e));return l},Batman.objectHasKey=function(e,t){return typeof e.hasKey=="function"?e.hasKey(t):t in e},Batman.contains=function(e,t){return e.indexOf?i.call(e,t)>=0:typeof e.has=="function"?e.has(t):Batman.objectHasKey(e,t)},Batman.get=function(e,t){return typeof e.get=="function"?e.get(t):Batman.Property.forBaseAndKey(e,t).getValue()},Batman.getPath=function(e,t){var n,r,i;for(r=0,i=t.length;r<i;r++){n=t[r];if(e==null)return void 0;e=Batman.get(e,n);if(e==null)return e}return e},Batman.escapeHTML=function(){var e;return e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},function(t){return(""+t).replace(/[&<>'"]/g,function(t){return e[t]})}}(),Batman.translate=function(e,t){return t==null&&(t={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,e),t)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(e){var t;return(t=Batman.navigator)!=null?t.redirect(e):void 0},Batman.initializeObject=function(e){return e._batman!=null?e._batman.check(e):e._batman=new Batman._Batman(e)}}.call(this),function(){}.call(this),function(){var e;Batman._Batman=e=function(){function e(e){this.object=e}return e.prototype.check=function(e){return e!==this.object?(e._batman=new Batman._Batman(e),!1):!0},e.prototype.get=function(e){var t,n;n=this.getAll(e);switch(n.length){case 0:return void 0;case 1:return n[0];default:return t=n[0].concat!=null?function(e,t){return e.concat(t)}:n[0].merge!=null?function(e,t){return e.merge(t)}:n.every(function(e){return typeof e=="object"})?(n.unshift({}),function(e,t){return Batman.extend(e,t)}):void 0,t?n.reduceRight(t):n}},e.prototype.getFirst=function(e){var t;return t=this.getAll(e),t[0]},e.prototype.getAll=function(e){var t,n,r;return typeof e=="function"?t=e:t=function(t){var n;return(n=t._batman)!=null?n[e]:void 0},n=this.ancestors(t),(r=t(this.object))&&n.unshift(r),n},e.prototype.ancestors=function(e){var t,n,r,i,s,o,u;return e==null&&(e=function(e){return e}),i=[],t=!!this.object.prototype,n=t?(o=this.object.__super__)!=null?o.constructor:void 0:(r=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:r,n!=null&&((u=n._batman)!=null&&u.check(n),s=e(n),s!=null&&i.push(s),n._batman!=null&&(i=i.concat(n._batman.ancestors(e)))),i},e.prototype.set=function(e,t){return this[e]=t},e}()}.call(this),function(){Batman.Event=function(){function e(e,t){this.base=e,this.key=t,this.handlers=[],this._preventCount=0}return e.forBaseAndKey=function(e,t){return e.isEventEmitter?e.event(t):new Batman.Event(e,t)},e.prototype.isEvent=!0,e.prototype.isEqual=function(e){return this.constructor===e.constructor&&this.base===e.base&&this.key===e.key},e.prototype.hashKey=function(){var e;return this.hashKey=function(){return e},e="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},e.prototype.addHandler=function(e){return this.handlers.indexOf(e)===-1&&this.handlers.push(e),this.oneShot&&this.autofireHandler(e),this},e.prototype.removeHandler=function(e){var t;return(t=this.handlers.indexOf(e))!==-1&&this.handlers.splice(t,1),this},e.prototype.eachHandler=function(e){var t,n,r;this.handlers.slice().forEach(e);if((n=this.base)!=null?n.isEventEmitter:void 0)return t=this.key,(r=this.base._batman)!=null?r.ancestors(function(n){var r,i,s;if(n.isEventEmitter&&((i=n._batman)!=null?(s=i.events)!=null?s.hasOwnProperty(t):void 0:void 0))return r=n.event(t).handlers,r.slice().forEach(e)}):void 0},e.prototype.clearHandlers=function(){return this.handlers=[]},e.prototype.handlerContext=function(){return this.base},e.prototype.prevent=function(){return++this._preventCount},e.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},e.prototype.isPrevented=function(){return this._preventCount>0},e.prototype.autofireHandler=function(e){if(this._oneShotFired&&this._oneShotArgs!=null)return e.apply(this.handlerContext(),this._oneShotArgs)},e.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},e.prototype.fire=function(){var e,t;return this.isPrevented()||this._oneShotFired?!1:(t=this.handlerContext(),e=arguments,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments),this.eachHandler(function(n){return n.apply(t,e)}))},e.prototype.allowAndFire=function(){return this.allow(),this.fire.apply(this,arguments)},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PropertyEvent=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eachHandler=function(e){return this.base.eachObserver(e)},n.prototype.handlerContext=function(){return this.base.base},n}(Batman.Event)}.call(this),function(){var e=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(e){var t,n;return(t=this._batman)!=null?typeof t.get=="function"?(n=t.get("events"))!=null?n.hasOwnProperty(e):void 0:void 0:void 0},event:function(e){var t,n,r,i,s;return Batman.initializeObject(this),t=this.eventClass||Batman.Event,n=(s=this._batman).events||(s.events={}),n.hasOwnProperty(e)?r=n[e]:(this._batman.ancestors(function(t){var n,i;return r||(r=(n=t._batman)!=null?(i=n.events)!=null?i[e]:void 0:void 0)}),i=n[e]=new t(this,e),i.oneShot=r!=null?r.oneShot:void 0,i)},on:function(e,t){return this.event(e).addHandler(t)},once:function(e,t){var n,r;return n=this.event(e),r=function(){return t.apply(this,arguments),n.removeHandler(r)},n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutation:function(e){return function(){var t;return t=e.apply(this,arguments),this.event("change").fire(this,this),t}},prevent:function(e){return this.event(e).prevent(),this},allow:function(e){return this.event(e).allow(),this},isPrevented:function(e){return this.event(e).isPrevented()},fire:function(){var t,n,r;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],(r=this.event(n)).fire.apply(r,t)},allowAndFire:function(){var t,n,r;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],(r=this.event(n)).allowAndFire.apply(r,t)}}}.call(this),function(){var e=[].slice;Batman.Enumerable={isEnumerable:!0,map:function(e,t){var n;return t==null&&(t=Batman.container),n=[],this.forEach(function(){return n.push(e.apply(t,arguments))}),n},mapToProperty:function(e){var t;return t=[],this.forEach(function(n){return t.push(n.get(e))}),t},every:function(e,t){var n;return t==null&&(t=Batman.container),n=!0,this.forEach(function(){return n=n&&e.apply(t,arguments)}),n},some:function(e,t){var n;return t==null&&(t=Batman.container),n=!1,this.forEach(function(){return n=n||e.apply(t,arguments)}),n},reduce:function(t,n){var r,i;return r=0,i=this,this.forEach(function(){return n!=null?n=t.apply(null,[n].concat(e.call(arguments),[r],[i])):n=arguments[0]}),n},filter:function(e){var t,n;return t=new this.constructor,t.add?n=function(t,n){return e(n)&&t.add(n),t}:t.set?n=function(t,n,r){return e(n,r)&&t.set(n,r),t}:(t.push||(t=[]),n=function(t,n){return e(n)&&t.push(n),t}),this.reduce(n,t)},inGroupsOf:function(e){var t,n,r;return r=[],t=!1,n=0,this.forEach(function(i){return n++%e===0&&(t=[],r.push(t)),t.push(i)}),r}}}.call(this),function(){var e=[].slice;Batman.SimpleHash=function(){function t(e){this._storage={},this.length=0,e!=null&&this.update(e)}return Batman.extend(t.prototype,Batman.Enumerable),t.prototype.propertyClass=Batman.Property,t.prototype.hasKey=function(e){var t,n,r,i;if(this.objectKey(e)){if(!this._objectStorage)return!1;if(n=this._objectStorage[this.hashKeyFor(e)])for(r=0,i=n.length;r<i;r++){t=n[r];if(this.equality(t[0],e))return!0}return!1}return e=this.prefixedKey(e),this._storage.hasOwnProperty(e)},t.prototype.get=function(e){var t,n,r,i;if(!this.objectKey(e))return this._storage[this.prefixedKey(e)];if(!this._objectStorage)return void 0;if(n=this._objectStorage[this.hashKeyFor(e)])for(r=0,i=n.length;r<i;r++){t=n[r];if(this.equality(t[0],e))return t[1]}},t.prototype.set=function(e,t){var n,r,i,s,o,u;if(this.objectKey(e)){this._objectStorage||(this._objectStorage={}),r=(i=this._objectStorage)[u=this.hashKeyFor(e)]||(i[u]=[]);for(s=0,o=r.length;s<o;s++){n=r[s];if(this.equality(n[0],e))return n[1]=t}return this.length++,r.push([e,t]),t}return e=this.prefixedKey(e),this._storage[e]==null&&this.length++,this._storage[e]=t},t.prototype.unset=function(e){var t,n,r,i,s,o,u,a,f,l;if(!this.objectKey(e))return e=this.prefixedKey(e),o=this._storage[e],this._storage[e]!=null&&(this.length--,delete this._storage[e]),o;if(!this._objectStorage)return void 0;t=this.hashKeyFor(e);if(s=this._objectStorage[t])for(n=a=0,f=s.length;a<f;n=++a){l=s[n],r=l[0],u=l[1];if(this.equality(r,e))return i=s.splice(n,1),s.length||delete this._objectStorage[t],this.length--,i[0][1]}},t.prototype.getOrSet=function(e,t){var n;return n=this.get(e),n||(n=t(),this.set(e,n)),n},t.prototype.prefixedKey=function(e){return"_"+e},t.prototype.unprefixedKey=function(e){return e.slice(1)},t.prototype.hashKeyFor=function(e){return(e!=null?typeof e.hashKey=="function"?e.hashKey():void 0:void 0)||e},t.prototype.equality=function(e,t){return e===t?!0:e!==e&&t!==t?!0:(e!=null?typeof e.isEqual=="function"?e.isEqual(t):void 0:void 0)&&(t!=null?typeof t.isEqual=="function"?t.isEqual(e):void 0:void 0)?!0:!1},t.prototype.objectKey=function(e){return typeof e!="string"},t.prototype.forEach=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;i=[];if(this._objectStorage){f=this._objectStorage;for(n in f){o=f[n],l=o.slice();for(u=0,a=l.length;u<a;u++)c=l[u],r=c[0],s=c[1],i.push(e.call(t,r,s,this))}}h=this._storage;for(n in h)s=h[n],i.push(e.call(t,this.unprefixedKey(n),s,this));return i},t.prototype.keys=function(){var e;return e=[],Batman.SimpleHash.prototype.forEach.call(this,function(t){return e.push(t)}),e},t.prototype.toArray=t.prototype.keys,t.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},t.prototype.isEmpty=function(){return this.length===0},t.prototype.merge=function(){var t,n,r,i,s;r=1<=arguments.length?e.call(arguments,0):[],n=new this.constructor,r.unshift(this);for(i=0,s=r.length;i<s;i++)t=r[i],t.forEach(function(e,t){return n.set(e,t)});return n},t.prototype.update=function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.set(t,n));return r},t.prototype.replace=function(e){var t=this;return this.forEach(function(n,r){if(!(n in e))return t.unset(n)}),this.update(e)},t.prototype.toObject=function(){var e,t,n,r,i,s;t={},i=this._storage;for(e in i)r=i[e],t[this.unprefixedKey(e)]=r;if(this._objectStorage){s=this._objectStorage;for(e in s)n=s[e],t[e]=n[0][1]}return t},t.prototype.toJSON=t.prototype.toObject,t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.AssociationCurator=function(e){function r(e){this.model=e,r.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return t(r,e),r.availableAssociations=["belongsTo","hasOne","hasMany"],r.prototype.add=function(e){var t;return this.set(e.label,e),(t=this._byTypeStorage.get(e.associationType))||(t=new Batman.SimpleSet,this._byTypeStorage.set(e.associationType,t)),t.add(e)},r.prototype.getByType=function(e){return this._byTypeStorage.get(e)},r.prototype.getByLabel=function(e){return this.get(e)},r.prototype.reset=function(){return this.forEach(function(e,t){return t.reset()}),!0},r.prototype.merge=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],t=r.__super__.merge.apply(this,arguments),t._byTypeStorage=this._byTypeStorage.merge(e.map(function(e){return e._byTypeStorage})),t},r.prototype._markDirtyAttribute=function(e,t){var n;if((n=this.lifecycle.get("state"))!=="loading"&&n!=="creating"&&n!=="saving"&&n!=="saved"){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(e,t);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},r}(Batman.SimpleHash)}.call(this),function(){var e=[].slice;Batman.SimpleSet=function(){function t(){this._storage=[],this.length=0,arguments.length>0&&this.add.apply(this,arguments)}return Batman.extend(t.prototype,Batman.Enumerable),t.prototype.has=function(e){return!!~this._indexOfItem(e)},t.prototype.add=function(){var t,n,r,i,s;r=1<=arguments.length?e.call(arguments,0):[],t=[];for(i=0,s=r.length;i<s;i++){n=r[i];if(!!~this._indexOfItem(n))continue;this._storage.push(n),t.push(n)}return this.length=this._storage.length,this.fire&&t.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(e.call(t)))),t},t.prototype.remove=function(){var t,n,r,i,s,o;r=1<=arguments.length?e.call(arguments,0):[],i=[];for(s=0,o=r.length;s<o;s++){n=r[s];if(!~(t=this._indexOfItem(n)))continue;this._storage.splice(t,1),i.push(n)}return this.length=this._storage.length,this.fire&&i.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(e.call(i)))),i},t.prototype.find=function(e){var t,n,r,i;i=this._storage;for(n=0,r=i.length;n<r;n++){t=i[n];if(e(t))return t}},t.prototype.forEach=function(e,t){var n;return n=this,this._storage.slice().forEach(function(r){return e.call(t,r,null,n)})},t.prototype.isEmpty=function(){return this.length===0},t.prototype.clear=function(){var t;return t=this._storage,this._storage=[],this.length=0,this.fire&&t.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(e.call(t)))),t},t.prototype.replace=function(e){try{return typeof this.prevent=="function"&&this.prevent("change"),this.clear(),this.add.apply(this,e.toArray())}finally{typeof this.allowAndFire=="function"&&this.allowAndFire("change",this,this)}},t.prototype.toArray=function(){return this._storage.slice()},t.prototype.merge=function(){var t,n,r,i,s;n=1<=arguments.length?e.call(arguments,0):[],t=new this.constructor,n.unshift(this);for(i=0,s=n.length;i<s;i++)r=n[i],r.forEach(function(e){return t.add(e)});return t},t.prototype.indexedBy=function(e){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(e)||this._indexes.set(e,new Batman.SetIndex(this,e))},t.prototype.indexedByUnique=function(e){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(e)||this._uniqueIndexes.set(e,new Batman.UniqueSetIndex(this,e))},t.prototype.sortedBy=function(e,t){var n;return t==null&&(t="asc"),t=t.toLowerCase()==="desc"?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),n=this._sorts.get(e)||this._sorts.set(e,new Batman.Object),n.get(t)||n.set(t,new Batman.SetSort(this,e,t))},t.prototype.equality=Batman.SimpleHash.prototype.equality,t.prototype._indexOfItem=function(e){var t,n,r,i,s;s=this._storage;for(t=r=0,i=s.length;r<i;t=++r){n=s[t];if(this.equality(e,n))return t}return-1},t}()}.call(this),function(){var e=[].slice;Batman.Property=function(){function t(e,t){this.base=e,this.key=t}return Batman.mixin(t.prototype,Batman.EventEmitter),t._sourceTrackerStack=[],t.sourceTracker=function(){var e;return(e=this._sourceTrackerStack)[e.length-1]},t.defaultAccessor={get:function(e){return this[e]},set:function(e,t){return this[e]=t},unset:function(e){var t;return t=this[e],delete this[e],t},cache:!1},t.defaultAccessorForBase=function(e){var t;return((t=e._batman)!=null?t.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},t.accessorForBaseAndKey=function(e,t){var n,r,i,s=this;return(r=e._batman)!=null&&(n=(i=r.keyAccessors)!=null?i.get(t):void 0,n||r.ancestors(function(e){var r,i;return n||(n=(r=e._batman)!=null?(i=r.keyAccessors)!=null?i.get(t):void 0:void 0)})),n||this.defaultAccessorForBase(e)},t.forBaseAndKey=function(e,t){return e.isObservable?e.property(t):new Batman.Keypath(e,t)},t.withoutTracking=function(e){return this.wrapTrackingPrevention(e)()},t.wrapTrackingPrevention=function(e){return function(){Batman.Property.pushDummySourceTracker();try{return e.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},t.registerSource=function(e){var t;if(!e.isEventEmitter)return;return(t=this.sourceTracker())!=null?t.add(e):void 0},t.pushSourceTracker=function(){return Batman.Property._sourceTrackerStack.push(new Batman.SimpleSet)},t.pushDummySourceTracker=function(){return Batman.Property._sourceTrackerStack.push(null)},t.popSourceTracker=function(){return Batman.Property._sourceTrackerStack.pop()},t.prototype._isolationCount=0,t.prototype.cached=!1,t.prototype.value=null,t.prototype.sources=null,t.prototype.isProperty=!0,t.prototype.isDead=!1,t.prototype.eventClass=Batman.PropertyEvent,t.prototype.isEqual=function(e){return this.constructor===e.constructor&&this.base===e.base&&this.key===e.key},t.prototype.hashKey=function(){var e;return this.hashKey=function(){return e},e="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},t.prototype.event=function(e){var t,n;return t=this.eventClass||Batman.Event,this.events||(this.events={}),(n=this.events)[e]||(n[e]=new t(this,e)),this.events[e]},t.prototype.changeEvent=function(){var e;return e=this.event("change"),this.changeEvent=function(){return e},e},t.prototype.accessor=function(){var e;return e=this.constructor.accessorForBaseAndKey(this.base,this.key),this.accessor=function(){return e},e},t.prototype.eachObserver=function(e){var t;t=this.key,this.changeEvent().handlers.slice().forEach(e);if(this.base.isObservable)return this.base._batman.ancestors(function(n){var r,i;if(n.isObservable&&n.hasProperty(t))return i=n.property(t),r=i.changeEvent().handlers,r.slice().forEach(e)})},t.prototype.observers=function(){var e;return e=[],this.eachObserver(function(t){return e.push(t)}),e},t.prototype.hasObservers=function(){return this.observers().length>0},t.prototype.updateSourcesFromTracker=function(){var e,t;return t=this.constructor.popSourceTracker(),e=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(t){return t.removeHandler(e)}),this.sources=t,this._eachSourceChangeEvent(function(t){return t.addHandler(e)})},t.prototype._eachSourceChangeEvent=function(e){if(this.sources==null)return;return this.sources.forEach(function(t){return e(t.event("change"))})},t.prototype.getValue=function(){this.registerAsMutableSource();if(!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},t.prototype.isCachable=function(){var e;return this.isFinal()?!0:(e=this.accessor().cache,e!=null?!!e:!0)},t.prototype.isCached=function(){return this.isCachable()&&this.cached},t.prototype.isFinal=function(){return!!this.accessor()["final"]},t.prototype.refresh=function(){var e,t;this.cached=!1,e=this.value,t=this.getValue(),t!==e&&!this.isIsolated()&&this.fire(t,e);if(this.value!==void 0&&this.isFinal())return this.lockValue()},t.prototype.sourceChangeHandler=function(){var e,t=this;return e=this._handleSourceChange.bind(this),this.sourceChangeHandler=function(){return e},e},t.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:!this.isFinal()&&!this.hasObservers()?this.cached=!1:this.refresh()},t.prototype.valueFromAccessor=function(){var e;return(e=this.accessor().get)!=null?e.call(this.base,this.key):void 0},t.prototype.setValue=function(e){var t;if(!(t=this.accessor().set))return;return this._changeValue(function(){return t.call(this.base,this.key,e)})},t.prototype.unsetValue=function(){var e;if(!(e=this.accessor().unset))return;return this._changeValue(function(){return e.call(this.base,this.key)})},t.prototype._changeValue=function(e){var t;this.cached=!1,this.constructor.pushDummySourceTracker();try{t=e.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return!this.isCached()&&!this.hasObservers()&&this.die(),t},t.prototype.forget=function(e){return e!=null?this.changeEvent().removeHandler(e):this.changeEvent().clearHandlers()},t.prototype.observeAndFire=function(e){return this.observe(e),e.call(this.base,this.value,this.value,this.key)},t.prototype.observe=function(e){return this.changeEvent().addHandler(e),this.sources==null&&this.getValue(),this},t.prototype.observeOnce=function(e){var t,n;return t=this.changeEvent(),n=function(){return e.apply(this,arguments),t.removeHandler(n)},t.addHandler(n),this.sources==null&&this.getValue(),this},t.prototype._removeHandlers=function(){var e;return e=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(t){return t.removeHandler(e)}),delete this.sources,this.changeEvent().clearHandlers()},t.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},t.prototype.die=function(){var e,t;return this._removeHandlers(),(e=this.base._batman)!=null&&(t=e.properties)!=null&&t.unset(this.key),this.isDead=!0},t.prototype.fire=function(){var t;return(t=this.changeEvent()).fire.apply(t,e.call(arguments).concat([this.key]))},t.prototype.isolate=function(){return this._isolationCount===0&&(this._preIsolationValue=this.getValue()),this._isolationCount++},t.prototype.expose=function(){if(this._isolationCount===1)return this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null;if(this._isolationCount>0)return this._isolationCount--},t.prototype.isIsolated=function(){return this._isolationCount>0},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Keypath=function(e){function n(e,t){typeof t=="string"?(this.segments=t.split("."),this.depth=this.segments.length):(this.segments=[t],this.depth=1),n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isCachable=function(){return this.depth===1?n.__super__.isCachable.apply(this,arguments):!0},n.prototype.terminalProperty=function(){var e;e=Batman.getPath(this.base,this.segments.slice(0,-1));if(e==null)return;return Batman.Keypath.forBaseAndKey(e,this.segments[this.depth-1])},n.prototype.valueFromAccessor=function(){return this.depth===1?n.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},n.prototype.setValue=function(e){var t;return this.depth===1?n.__super__.setValue.apply(this,arguments):(t=this.terminalProperty())!=null?t.setValue(e):void 0},n.prototype.unsetValue=function(){var e;return this.depth===1?n.__super__.unsetValue.apply(this,arguments):(e=this.terminalProperty())!=null?e.unsetValue():void 0},n}(Batman.Property)}.call(this),function(){var e=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(e){var t,n;return(t=this._batman)!=null?(n=t.properties)!=null?typeof n.hasKey=="function"?n.hasKey
(e):void 0:void 0:void 0},property:function(e){var t,n,r;return Batman.initializeObject(this),n=this.propertyClass||Batman.Keypath,t=(r=this._batman).properties||(r.properties=new Batman.SimpleHash),t.get(e)||t.set(e,new n(this,e))},get:function(e){return this.property(e).getValue()},set:function(e,t){return this.property(e).setValue(t)},unset:function(e){return this.property(e).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(e,t){var n;return e?this.property(e).forget(t):(n=this._batman.properties)!=null&&n.forEach(function(e,t){return t.forget()}),this},observe:function(){var t,n,r;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],(r=this.property(n)).observe.apply(r,t),this},observeAndFire:function(){var t,n,r;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],(r=this.property(n)).observeAndFire.apply(r,t),this},observeOnce:function(){var t,n,r;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],(r=this.property(n)).observeOnce.apply(r,t),this}}}.call(this),function(){Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(e){var t;return(t=document.getElementById(e))!=null?typeof t.scrollIntoView=="function"?t.scrollIntoView():void 0:void 0},querySelectorAll:window.jQuery!=null?function(e,t){return jQuery(t,e)}:document.querySelectorAll!=null?function(e,t){return e.querySelectorAll(t)}:function(){},querySelector:window.jQuery!=null?function(e,t){return jQuery(t,e)[0]}:document.querySelector!=null?function(e,t){return e.querySelector(t)}:function(){},partial:function(e,t,n,r){var i;return r.prevent("rendered"),i=new Batman.View({source:t,context:n}),i.on("ready",function(){return Batman.setInnerHTML(e,""),Batman.appendChild(e,i.get("node")),r.allowAndFire("rendered")})},propagateBindingEvent:Batman.propagateBindingEvent=function(e,t){var n,r,i,s,o;while(n=(n||t).parentNode){i=Batman._data(n,"bindings");if(i!=null)for(s=0,o=i.length;s<o;s++)r=i[s],typeof r.childBindingAdded=="function"&&r.childBindingAdded(e)}},propagateBindingEvents:Batman.propagateBindingEvents=function(e){var t,n,r,i,s,o,u,a;a=e.childNodes;for(i=0,o=a.length;i<o;i++)r=a[i],Batman.propagateBindingEvents(r);if(n=Batman._data(e,"bindings"))for(s=0,u=n.length;s<u;s++)t=n[s],Batman.propagateBindingEvent(t,e)},trackBinding:Batman.trackBinding=function(e,t){var n;return(n=Batman._data(t,"bindings"))?n.push(e):Batman._data(t,"bindings",[e]),Batman.DOM.fire("bindingAdded",e),Batman.propagateBindingEvent(e,t),!0},onParseExit:Batman.onParseExit=function(e,t){var n;return n=Batman._data(e,"onParseExit")||Batman._data(e,"onParseExit",new Batman.SimpleSet),t!=null&&n.add(t),n},forgetParseExit:Batman.forgetParseExit=function(e,t){return Batman.removeData(e,"onParseExit",!0)},defineView:function(e,t){var n;return n=t.innerHTML,Batman.View.store.set(Batman.Navigator.normalizePath(e),n),n},setInnerHTML:Batman.setInnerHTML=function(e,t){var n,r,i,s,o,u,a;r=function(){var t,r,i,s;i=e.childNodes,s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(n);return s}();for(s=0,u=r.length;s<u;s++)n=r[s],Batman.DOM.willRemoveNode(n);i=e.innerHTML=t;for(o=0,a=r.length;o<a;o++)n=r[o],Batman.DOM.didRemoveNode(n);return i},setStyleProperty:Batman.setStyleProperty=function(e,t,n,r){return e.style.setAttribute?e.style.setAttribute(t,n,r):e.style.setProperty(t,n,r)},removeNode:Batman.removeNode=function(e){var t;return Batman.DOM.willRemoveNode(e),(t=e.parentNode)!=null&&t.removeChild(e),Batman.DOM.didRemoveNode(e)},destroyNode:Batman.destroyNode=function(e){return Batman.DOM.willDestroyNode(e),Batman.removeNode(e),Batman.DOM.didDestroyNode(e)},appendChild:Batman.appendChild=function(e,t){return Batman.DOM.willInsertNode(t),e.appendChild(t),Batman.DOM.didInsertNode(t)},removeOrDestroyNode:Batman.removeOrDestroyNode=function(e){var t;return t=Batman._data(e,"view"),t||(t=Batman._data(e,"yielder")),t!=null&&t.get("cached")?Batman.DOM.removeNode(e):Batman.DOM.destroyNode(e)},insertBefore:Batman.insertBefore=function(e,t,n){return n==null&&(n=null),!n||e.childNodes.length<=0?Batman.appendChild(e,t):(Batman.DOM.willInsertNode(t),e.insertBefore(t,n),Batman.DOM.didInsertNode(t))},valueForNode:function(e,t,n){var r;t==null&&(t=""),n==null&&(n=!0),r=arguments.length>1;switch(e.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return r?e.value=t:e.value;case"SELECT":if(r)return e.value=t;break;default:return r?Batman.setInnerHTML(e,n?Batman.escapeHTML(t):t):e.innerHTML}},nodeIsEditable:function(e){var t;return(t=e.nodeName.toUpperCase())==="INPUT"||t==="TEXTAREA"||t==="SELECT"},addEventListener:Batman.addEventListener=function(e,t,n){var r;return(r=Batman._data(e,"listeners"))||(r=Batman._data(e,"listeners",{})),r[t]||(r[t]=[]),r[t].push(n),Batman.hasAddEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},removeEventListener:Batman.removeEventListener=function(e,t,n){var r,i,s;if(s=Batman._data(e,"listeners"))if(r=s[t])i=r.indexOf(n),i!==-1&&r.splice(i,1);return Batman.hasAddEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},hasAddEventListener:Batman.hasAddEventListener=typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0,preventDefault:Batman.preventDefault=function(e){return typeof e.preventDefault=="function"?e.preventDefault():e.returnValue=!1},stopPropagation:Batman.stopPropagation=function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},willInsertNode:function(e){var t,n,r,i,s,o;n=Batman._data(e,"view"),n!=null&&n.fire("beforeAppear",e),(s=Batman.data(e,"show"))!=null&&s.call(e),o=e.childNodes;for(r=0,i=o.length;r<i;r++)t=o[r],Batman.DOM.willInsertNode(t);return!0},didInsertNode:function(e){var t,n,r,i,s;n=Batman._data(e,"view"),n&&(n.fire("appear",e),n.applyYields()),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],Batman.DOM.didInsertNode(t);return!0},willRemoveNode:function(e){var t,n,r,i,s,o;n=Batman._data(e,"view"),n&&n.fire("beforeDisappear",e),(s=Batman.data(e,"hide"))!=null&&s.call(e),o=e.childNodes;for(r=0,i=o.length;r<i;r++)t=o[r],Batman.DOM.willRemoveNode(t);return!0},didRemoveNode:function(e){var t,n,r,i,s;n=Batman._data(e,"view"),n&&(n.retractYields(),n.fire("disappear",e)),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],Batman.DOM.didRemoveNode(t);return!0},willDestroyNode:function(e){var t,n,r,i,s;n=Batman._data(e,"view"),n&&(n.fire("beforeDestroy",e),n.get("yields").forEach(function(t,n){var r,i,s;s=[];for(r=0,i=n.length;r<i;r++)e=n[r].node,s.push(Batman.DOM.willDestroyNode(e));return s})),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],Batman.DOM.willDestroyNode(t);return!0},didDestroyNode:function(e){var t,n,r,i,s,o,u,a,f;o=Batman._data(e,"view"),o&&(o.fire("destroy",e),o.get("yields").forEach(function(t,n){var r,i,s;s=[];for(r=0,i=n.length;r<i;r++)e=n[r].node,s.push(Batman.DOM.didDestroyNode(e));return s})),(t=Batman._data(e,"bindings"))&&t.forEach(function(e){return e.die()});if(s=Batman._data(e,"listeners"))for(i in s)r=s[i],r.forEach(function(t){return Batman.removeEventListener(e,i,t)});Batman.removeData(e),Batman.removeData(e,void 0,!0),f=e.childNodes;for(u=0,a=f.length;u<a;u++)n=f[u],Batman.DOM.didDestroyNode(n);return!0}},Batman.mixin(Batman.DOM,Batman.EventEmitter,Batman.Observable),Batman.DOM.event("bindingAdded")}.call(this),function(){var e=[].slice;Batman.DOM.readers={target:function(e,t,n,r){return Batman.DOM.readers.bind(e,t,n,r,"nodeChange"),!0},source:function(e,t,n,r){return Batman.DOM.readers.bind(e,t,n,r,"dataChange"),!0},bind:function(e,t,n,r,i){var s;s=!1;switch(e.nodeName.toLowerCase()){case"input":switch(e.getAttribute("type")){case"checkbox":return Batman.DOM.attrReaders.bind(e,"checked",t,n,r,i),!0;case"radio":s=Batman.DOM.RadioBinding;break;case"file":s=Batman.DOM.FileBinding}break;case"select":s=Batman.DOM.SelectBinding}return s||(s=Batman.DOM.Binding),function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(s,arguments,function(){}),!0},context:function(e,t,n,r){return n.descendWithKey(t)},mixin:function(e,t,n,r){return new Batman.DOM.MixinBinding(e,t,n.descend(Batman.mixins),r),!0},showif:function(e,t,n,r,i){return new Batman.DOM.ShowHideBinding(e,t,n,r,!1,i),!0},hideif:function(){var t;return(t=Batman.DOM.readers).showif.apply(t,e.call(arguments).concat([!0]))},insertif:function(e,t,n,r,i){return new Batman.DOM.InsertionBinding(e,t,n,r,!1,i),!0},removeif:function(){var t;return(t=Batman.DOM.readers).insertif.apply(t,e.call(arguments).concat([!0]))},route:function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.DOM.RouteBinding,arguments,function(){}),!0},view:function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.DOM.ViewBinding,arguments,function(){}),!1},partial:function(e,t,n,r){return Batman.DOM.partial(e,t,n,r),!0},defineview:function(e,t,n,r){return Batman.onParseExit(e,function(){var t;return(t=e.parentNode)!=null?t.removeChild(e):void 0}),Batman.DOM.defineView(t,e),!1},renderif:function(e,t,n,r){return new Batman.DOM.DeferredRenderingBinding(e,t,n,r),!1},yield:function(e,t){return Batman.onParseExit(e,function(){return Batman.DOM.Yield.withName(t).set("containerNode",e)}),!0},contentfor:function(e,t,n,r,i){return i==null&&(i="append"),Batman.onParseExit(e,function(){var n;return(n=e.parentNode)!=null&&n.removeChild(e),r.view.pushYieldAction(t,i,e)}),!0},replace:function(e,t,n,r){return Batman.DOM.readers.contentfor(e,t,n,r,"replace"),!0}}}.call(this),function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Batman.DOM.events={click:function(t,n,r,i){return i==null&&(i="click"),Batman.addEventListener(t,i,function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],n.apply(null,[t].concat(e.call(i),[r])),Batman.preventDefault(i[0])}),t.nodeName.toUpperCase()==="A"&&!t.href&&(t.href="#"),t},doubleclick:function(e,t,n){return Batman.DOM.events.click(e,t,n,"dblclick")},change:function(n,r,i){var s,o,u,f,l,c;o=function(){var e;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return(e=n.type.toLowerCase(),t.call(Batman.DOM.textInputTypes,e)>=0)?(u=r,r=function(e,t){if(t.type==="keyup"&&Batman.DOM.events.isEnter(t))return;return u.apply(null,arguments)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),c=[];for(f=0,l=o.length;f<l;f++)s=o[f],c.push(Batman.addEventListener(n,s,function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],r.apply(null,[n].concat(e.call(t),[i]))}));return c},isEnter:function(e){var t,n;return 13<=(t=e.keyCode)&&t<=14||13<=(n=e.which)&&n<=14||e.keyIdentifier==="Enter"||e.key==="Enter"},submit:function(t,n,r){return Batman.DOM.nodeIsEditable(t)?(Batman.addEventListener(t,"keydown",function(){var n;n=1<=arguments.length?e.call(arguments,0):[];if(Batman.DOM.events.isEnter(n[0]))return Batman.DOM._keyCapturingNode=t}),Batman.addEventListener(t,"keyup",function(){var i;i=1<=arguments.length?e.call(arguments,0):[];if(Batman.DOM.events.isEnter(i[0]))return Batman.DOM._keyCapturingNode===t&&(Batman.preventDefault(i[0]),n.apply(null,[t].concat(e.call(i),[r]))),Batman.DOM._keyCapturingNode=null})):Batman.addEventListener(t,"submit",function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],Batman.preventDefault(i[0]),n.apply(null,[t].concat(e.call(i),[r]))}),t},other:function(t,n,r,i){return Batman.addEventListener(t,n,function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],r.apply(null,[t].concat(e.call(n),[i]))})}}}.call(this),function(){Batman.DOM.attrReaders={_parseAttribute:function(e){return e==="false"&&(e=!1),e==="true"&&(e=!0),e},source:function(e,t,n,r,i){return Batman.DOM.attrReaders.bind(e,t,n,r,i,"dataChange")},bind:function(e,t,n,r,i,s){var o;return o=function(){switch(t){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(o,arguments,function(){}),!0},context:function(e,t,n,r){return r.descendWithKey(n,t)},event:function(e,t,n,r){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.DOM.EventBinding,arguments,function(){}),!0},addclass:function(e,t,n,r,i,s){return new Batman.DOM.AddClassBinding(e,t,n,r,i,!1,s),!0},removeclass:function(e,t,n,r,i){return Batman.DOM.attrReaders.addclass(e,t,n,r,i,!0)},foreach:function(e,t,n,r,i){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.DOM.IteratorBinding,arguments,function(){}),!1},formfor:function(e,t,n,r){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.DOM.FormBinding,arguments,function(){}),r.descendWithKey(n,t)}}}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function i(){var e;e=1<=arguments.length?r.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,e)}var s,o,u,a;return n(i,e),Batman.initializeObject(i),Batman.initializeObject(i.prototype),i.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(r.call(arguments)))},i.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},i.prototype.mixin=i.classMixin,s=0,i.prototype._batmanID=function(){var e;return this._batmanID=function(){return e},e=s++},i.prototype.hashKey=function(){var e;if(typeof this.isEqual=="function")return;return this.hashKey=function(){return e},e="<Batman.Object "+this._batmanID()+">"},i.prototype.toJSON=function(){var e,n,r;n={};for(e in this){if(!t.call(this,e))continue;r=this[e],e!=="_batman"&&e!=="hashKey"&&e!=="_batmanID"&&(n[e]=(r!=null?r.toJSON:void 0)?r.toJSON():r)}return n},o=function(e,t){var n,r,i,s;typeof t=="function"&&(t={get:t}),s=["cachable","cacheable"];for(r=0,i=s.length;r<i;r++)n=s[r],n in t&&("cache"in t||(t.cache=t[n]));return t},u=function(e){return function(t){return{get:function(n){var r,i,s,o=this;return s=t.get.apply(this,arguments),typeof s!="undefined"?s:(i=!1,r=function(e,t){return i&&o.set(n,t),s=t},e.call(this,r,n),i=!0,s)},cache:!0}}},a=function(e,t){var n,r;t=(typeof t=="function"?t(e):void 0)||t;for(n in e)r=e[n],n in t||(t[n]=r);return t},i._defineAccessor=function(){var e,t,n,i,s,a,l,c,h;n=2<=arguments.length?r.call(arguments,0,s=arguments.length-1):(s=0,[]),e=arguments[s++];if(e==null)return Batman.Property.defaultAccessorForBase(this);if(n.length===0&&(c=Batman.typeOf(e))!=="Object"&&c!=="Function")return Batman.Property.accessorForBaseAndKey(this,e);if(typeof e.promise=="function")return this._defineWrapAccessor.apply(this,r.call(n).concat([u(e.promise)]));Batman.initializeObject(this);if(n.length===0)return this._batman.defaultAccessor=o(this,e);(i=this._batman).keyAccessors||(i.keyAccessors=new Batman.SimpleHash),h=[];for(a=0,l=n.length;a<l;a++)t=n[a],h.push(this._batman.keyAccessors.set(t,o(this,e)));return h},i.prototype._defineAccessor=i._defineAccessor,i._defineWrapAccessor=function(){var e,t,n,i,s,o,u;t=2<=arguments.length?r.call(arguments,0,i=arguments.length-1):(i=0,[]),n=arguments[i++],Batman.initializeObject(this);if(t.length===0)return this._defineAccessor(a(this._defineAccessor(),n));u=[];for(s=0,o=t.length;s<o;s++)e=t[s],u.push(this._defineAccessor(e,a(this._defineAccessor(e),n)));return u},i.prototype._defineWrapAccessor=i._defineWrapAccessor,i.classAccessor=i._defineAccessor,i.accessor=function(){var e;return(e=this.prototype)._defineAccessor.apply(e,arguments)},i.prototype.accessor=i._defineAccessor,i.wrapClassAccessor=i._defineWrapAccessor,i.wrapAccessor=function(){var e;return(e=this.prototype)._defineWrapAccessor.apply(e,arguments)},i.prototype.wrapAccessor=i._defineWrapAccessor,i.classMixin(Batman.EventEmitter,Batman.Observable),i.mixin(Batman.EventEmitter,Batman.Observable),i.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},i.singleton=function(e){return e==null&&(e="sharedInstance"),this.classAccessor(e,{get:function(){var t;return this[t="_"+e]||(this[t]=new this)}})},i.accessor("_batmanID",function(){return this._batmanID()}),i}(Object),Batman.Object=e}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Renderer=function(t){function r(t,n,i){this.node=t,this.context=n,this.view=i,this.resume=e(this.resume,this),this.start=e(this.start,this),r.__super__.constructor.call(this),this.context instanceof Batman.RenderContext,this.immediate=Batman.setImmediate(this.start)}var i,s,o,u,f,l,h,p,d,v,m;n(r,t),r.prototype.deferEvery=50,r.prototype.start=function(){return this.startTime=new Date,this.parseNode(this.node)},r.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},r.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.fire("parsed"),this.fire("rendered")},r.prototype.stop=function(){return Batman.clearImmediate(this.immediate),this.fire("stopped")},m=["parsed","rendered","stopped"];for(h=0,d=m.length;h<d;h++)u=m[h],r.prototype.event(u).oneShot=!0;i=/^data\-(.*)/,s=["view","renderif","foreach","formfor","context","bind","source","target"],o={};for(l=p=0,v=s.length;p<v;l=++p)f=s[l],o[f]=l;return r.prototype._sortBindings=function(e,t){var n,r;return n=o[e[0]],r=o[t[0]],n==null&&(n=s.length),r==null&&(r=s.length),n>r?1:r>n?-1:e[0]>t[0]?1:t[0]>e[0]?-1:0},r.prototype.parseNode=function(e){var t,n,r,s,o,u,a,l,c,h,p,d,v,m,g,y,b,w,E,S=this;if(this.deferEvery&&new Date-this.startTime>this.deferEvery){this.resumeNode=e,this.timeout=Batman.setImmediate(this.resume);return}if(e.getAttribute&&e.attributes){r=[],y=e.attributes;for(d=0,m=y.length;d<m;d++){n=y[d],f=(b=n.nodeName.match(i))!=null?b[1]:void 0;if(!f)continue;r.push((o=f.split("-")).length>1?[o[0],o.slice(1,o.length+1||9e9).join("-"),n.value]:[f,void 0,n.value])}w=r.sort(this._sortBindings);for(v=0,g=w.length;v<g;v++){E=w[v],f=E[0],t=E[1],s=E[2],l=t?typeof (h=Batman.DOM.attrReaders)[f]=="function"?h[f](e,t,s,this.context,this):void 0:typeof (p=Batman.DOM.readers)[f]=="function"?p[f](e,s,this.context,this):void 0;if(l===!1){c=!0;break}l instanceof Batman.RenderContext&&(a=this.context,this.context=l,Batman.onParseExit(e,function(){return S.context=a}))}}return(u=this.nextNode(e,c))?this.parseNode(u):this.finish()},r.prototype.nextNode=function(e,t){var n,r,i,s,o,u;if(!t){n=e.childNodes;if(n!=null?n.length:void 0)return n[0]}s=e.nextSibling,(o=Batman.onParseExit(e))!=null&&o.forEach(function(e){return e()}),Batman.forgetParseExit(e);if(this.node===e)return;if(s)return s;r=e;while(r=r.parentNode){i=r.nextSibling,(u=Batman.onParseExit(r))!=null&&u.forEach(function(e){return e()}),Batman.forgetParseExit(r);if(this.node===r)return;if(i)return i}},r}(Batman.Object)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractBinding=function(t){function r(t,n,r,i,s){this.node=t,this.keyPath=n,this.renderContext=r,this.renderer=i,this.only=s!=null?s:!1,this._fireDataChange=e(this._fireDataChange,this),this._fireNodeChange=e(this._fireNodeChange,this),this.parseFilter(),this.bindImmediately&&this.bind()}var i,s,o;return n(r,t),o=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|([a-zA-Z][\w\-\.]*[\?\!]?))\s*(?=$|,)/g,i=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,s=/(?!^\s*)\[(.*?)\]/g,r.accessor("filteredValue",{get:function(){var e,t,n,r;return r=this.get("unfilteredValue"),n=this,e=this.get("renderContext"),this.filterFunctions.length>0?(t=this.filterFunctions.reduce(function(t,r,i){var s;s=n.filterArguments[i].map(function(e){return e._keypath?n.renderContext.get(e._keypath):e}),s.unshift(t);while(s.length<r.length-1)s.push(void 0);return s.push(n),r.apply(e,s)},r),t):r},set:function(e,t){return this.set("unfilteredValue",t)}}),r.accessor("unfilteredValue",{get:function(){var e;return(e=this.get("key"))?Batman.RenderContext.deProxy(Batman.getPath(this,["keyContext",e])):this.get("value")},set:function(e,t){var n,r,i;if(!(n=this.get("key")))return this.set("value",t);r=this.get("keyContext");if(r&&r!==Batman.container)return i=Batman.Property.forBaseAndKey(r,n),i.setValue(t)}}),r.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),r.prototype.bindImmediately=!0,r.prototype.shouldSet=!0,r.prototype.isInputBinding=!1,r.prototype.escapeValue=!0,r.prototype.isTwoWay=function(){return this.key!=null&&this.filterFunctions.length===0},r.prototype.bind=function(){var e,t;this.node!=null&&((e=this.only)===!1||e==="nodeChange")&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange),this.only==="nodeChange"&&this._fireNodeChange()),((t=this.only)===!1||t==="dataChange")&&this.observeAndFire("filteredValue",this._fireDataChange);if(this.node!=null)return Batman.DOM.trackBinding(this,this.node)},r.prototype._fireNodeChange=function(e){var t;return this.shouldSet=!1,t=this.value||this.get("keyContext"),typeof this.nodeChange=="function"&&this.nodeChange(this.node,t,e),this.fire("nodeChange",this.node,t),this.shouldSet=!0},r.prototype._fireDataChange=function(e){if(this.shouldSet)return typeof this.dataChange=="function"&&this.dataChange(e,this.node),this.fire("dataChange",e,this.node)},r.prototype.die=function(){var e;return this.forget(),(e=this._batman.properties)!=null&&e.forEach(function(e,t){return t.die()}),this.fire("die"),this.dead=!0,!0},r.prototype.parseFilter=function(){var e,t,n,r,o,u,a,f,l;this.filterFunctions=[],this.filterArguments=[],a=this.keyPath;while(i.test(a))a=a.replace(i,"]['$1']");o=a.replace(s," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{u=this.parseSegment(f=o.shift())[0]}catch(c){}u&&u._keypath?this.key=u._keypath:this.value=u;if(o.length){while(r=o.shift()){l=r.indexOf(" "),l===-1&&(l=r.length),n=r.substr(0,l),e=r.substr(l),!!(t=Batman.Filters[n]),this.filterFunctions.push(t);try{this.filterArguments.push(this.parseSegment(e))}catch(c){}}return!0}},r.prototype.parseSegment=function(e){return e=e.replace(o,function(e,t,n,r,i,s,o){var u;return t==null&&(t=""),u=s?'{"_keypath": "'+s+'"}':n||r||i,t+u}),JSON.parse("["+e+"]")},r}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ViewBinding=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return t(n,e),n.prototype.dataChange=function(e){var t=this;if(e==null)return;return e.isView?(this.view=e,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new e({node:this.node,context:this.renderContext,parentView:this.renderer.view}),this.view.on("ready",function(){return t.renderer.allowAndFire("rendered")}),this.die()},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ViewArgumentBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ShowHideBinding=function(e){function n(e,t,r,i,s,o){var u;this.invert=o!=null?o:!1,u=e.style.display;if(!u||u==="none")u="";this.originalDisplay=u,n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.dataChange=function(e){var t,n,r;return n=Batman._data(this.node,"view"),!!e==!this.invert?(n!=null&&n.fire("beforeAppear",this.node),(r=Batman.data(this.node,"show"))!=null&&r.call(this.node),this.node.style.display=this.originalDisplay,n!=null?n.fire("appear",this.node):void 0):(n!=null&&n.fire("beforeDisappear",this.node),typeof (t=Batman.data(this.node,"hide"))=="function"?t.call(this.node):Batman.setStyleProperty(this.node,"display","none","important"),n!=null?n.fire("disappear",this.node):void 0)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.SelectBinding=function(t){function r(){this.updateOptionBindings=e(this.updateOptionBindings,this),this.nodeChange=e(this.nodeChange,this),this.dataChange=e(this.dataChange,this),this.childBindingAdded=e(this.childBindingAdded,this),this.selectedBindings=new Batman.SimpleSet,r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.isInputBinding=!0,r.prototype.firstBind=!0,r.prototype.childBindingAdded=function(e){var t,n=this;if(e instanceof Batman.DOM.CheckedBinding)e.on("dataChange",t=function(){return n.nodeChange()}),e.on("die",function(){return e.forget("dataChange",t),n.selectedBindings.remove(e)}),this.selectedBindings.add(e);else{if(!(e instanceof Batman.DOM.IteratorBinding))return;e.on("nodeAdded",t=function(){return n._fireDataChange(n.get("filteredValue"))}),e.on("nodeRemoved",t),e.on("die",function(){return e.forget("nodeAdded",t),e.forget("nodeRemoved",t)})}return this._fireDataChange(this.get("filteredValue"))},r.prototype.dataChange=function(e){var t,n,r,i,s,o,u,a=this;if(e!=null?e.forEach:void 0){r={},u=this.node.children;for(i=0,s=u.length;i<s;i++)t=u[i],t.selected=!1,n=r[o=t.value]||(r[o]=[]),n.push(t);e.forEach(function(e){var t,n,i,s,o;if(t=r[e]){o=[];for(i=0,s=t.length;i<s;i++)n=t[i],o.push(n.selected=!0);return o}})}else typeof e=="undefined"&&this.firstBind?this.set("unfilteredValue",this.node.value):Batman.DOM.valueForNode(this.node,e,this.escapeValue),this.firstBind=!1;this.updateOptionBindings()},r.prototype.nodeChange=function(){var e,t;this.isTwoWay()&&(t=this.node.multiple?function(){var t,n,r,i;r=this.node.children,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.selected&&i.push(e.value);return i}.call(this):this.node.value,typeof t===Array&&t.length===1&&(t=t[0]),this.set("unfilteredValue",t),this.updateOptionBindings())},r.prototype.updateOptionBindings=function(){return this.selectedBindings.forEach(function(e){return e._fireNodeChange()})},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.RouteBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.onATag=!1,n.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||Batman.App.get("current.dispatcher")}),n.prototype.bind=function(){var e=this;return this.node.nodeName.toUpperCase()==="A"&&(this.onATag=!0),n.__super__.bind.apply(this,arguments),Batman.DOM.events.click(this.node,function(t,n){var r;if(n.__batmanActionTaken)return;n.__batmanActionTaken=!0,r=e.pathFromValue(e.get("filteredValue"));if(r!=null)return Batman.redirect(r)})},n.prototype.dataChange=function(e){var t;e!=null&&(t=this.pathFromValue(e));if(this.onATag)return t!=null?t=Batman.navigator.linkTo(t):t="#",this.node.href=t},n.prototype.pathFromValue=function(e){var t;if(e!=null)return e.isNamedRouteQuery?e.get("path"):(t=this.get("dispatcher"))!=null?t.pathFromParams(e):void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.RadioBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isInputBinding=!0,n.prototype.dataChange=function(e){var t;if((t=this.get("filteredValue"))!=null)return this.node.checked=t===this.node.value;if(this.node.checked)return this.set("filteredValue",this.node.value)},n.prototype.nodeChange=function(e){if(this.isTwoWay())return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(e.value))},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.MixinBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.dataChange=function(e){if(e!=null)return Batman.mixin(this.node,e)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.FileBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isInputBinding=!0,n.prototype.nodeChange=function(e,t){if(!this.isTwoWay())return;return e.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(e.files)):this.set("filteredValue",e.files[0])},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.DeferredRenderingBinding=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return t(n,e),n.prototype.rendered=!1,n.prototype.nodeChange=function(){},n.prototype.dataChange=function(e){if(e&&!this.rendered)return this.render()},n.prototype.render=function(){return new Batman.Renderer(this.node,this.renderContext,this.renderer.view),this.rendered=!0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.Binding=function(e){function n(e){var t;this.isInputBinding=(t=e.nodeName.toLowerCase())==="input"||t==="textarea",n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.nodeChange=function(e,t){if(this.isTwoWay())return this.set("filteredValue",this.node.value)},n.prototype.dataChange=function(e,t){return Batman.DOM.valueForNode(this.node,e,this.escapeValue)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.DOM.AbstractAttributeBinding=function(e){function r(){var e,t,i;i=arguments[0],t=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],this.attributeName=t,r.__super__.constructor.apply(this,[i].concat(n.call(e)))}return t(r,e),r}(Batman.DOM.AbstractBinding)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.FormBinding=function(t){function r(t,n,i,s,o,u){this.childBindingAdded=e(this.childBindingAdded,this),r.__super__.constructor.apply(this,arguments),this.contextName=n,delete this.attributeName,Batman.DOM.events.submit(this.get("node"
),function(e,t){return Batman.preventDefault(t)}),this.setupErrorsList()}return n(r,t),r.current=null,r.prototype.errorClass="error",r.prototype.defaultErrorsListSelector="div.errors",r.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),r.prototype.childBindingAdded=function(e){var t,n,r;if(e.isInputBinding&&Batman.isChildOf(this.get("node"),e.get("node"))&&~(n=e.get("key").indexOf(this.contextName)))return r=e.get("node"),t=e.get("key").slice(n+this.contextName.length+1),new Batman.DOM.AddClassBinding(r,this.errorClass,this.get("keyPath")+(" | get 'errors."+t+".length'"),this.renderContext,this.renderer)},r.prototype.setupErrorsList=function(){if(this.errorsListNode=Batman.DOM.querySelector(this.get("node"),this.get("errorsListSelector"))){Batman.setInnerHTML(this.errorsListNode,this.errorsListHTML());if(!this.errorsListNode.getAttribute("data-showif"))return this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length")}},r.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.EventBinding=function(e){function n(e,t,r,i){var s,o,u,a=this;n.__super__.constructor.apply(this,arguments),u=this.node.getAttribute("data-confirm"),o=function(){var e;if(u&&!confirm(u))return;return(e=a.get("filteredValue"))!=null?e.apply(a.get("callbackContext"),arguments):void 0},(s=Batman.DOM.events[this.attributeName])?s(this.node,o,i):Batman.DOM.events.other(this.node,this.attributeName,o,i),this.bind()}return t(n,e),n.prototype.bindImmediately=!1,n.accessor("callbackContext",function(){var e;return e=this.key.split("."),e.pop(),e.length>0?this.get("keyContext").get(e.join(".")):this.get("keyContext")}),n.wrapAccessor("unfilteredValue",function(e){return{get:function(){var t,n,r,i;if(n=this.get("key")){i=n.split(".");if(i.length>1){t=i.pop(),r=Batman.getPath(this,["keyContext"].concat(i));if(r!=null)return r=Batman.RenderContext.deProxy(r),r[t]}}return e.get.apply(this,arguments)}}}),n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.NodeAttributeBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.dataChange=function(e){return e==null&&(e=""),this.node[this.attributeName]=e},n.prototype.nodeChange=function(e){if(this.isTwoWay())return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(e[this.attributeName]))},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.CheckedBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isInputBinding=!0,n.prototype.dataChange=function(e){return this.node[this.attributeName]=!!e},n}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AttributeBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.dataChange=function(e){return this.node.setAttribute(this.attributeName,e)},n.prototype.nodeChange=function(e){if(this.isTwoWay())return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(e.getAttribute(this.attributeName)))},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AddClassBinding=function(e){function n(e,t,r,i,s,o,u){var a,f;this.invert=u!=null?u:!1,f=t.split("|"),this.classes=function(){var e,t,n;n=[];for(e=0,t=f.length;e<t;e++)a=f[e],n.push({name:a,pattern:new RegExp("(?:^|\\s)"+a+"(?:$|\\s)","i")});return n}(),n.__super__.constructor.apply(this,arguments),delete this.attributeName}return t(n,e),n.prototype.dataChange=function(e){var t,n,r,i,s,o,u,a;t=this.node.className,u=this.classes;for(s=0,o=u.length;s<o;s++)a=u[s],r=a.name,i=a.pattern,n=i.test(t),!!e==!this.invert?n||(this.node.className=""+t+" "+r):n&&(this.node.className=t.replace(i," "));return!0},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractCollectionBinding=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.bindCollection=function(e){var t;return e instanceof Batman.Hash&&(e=e.meta),e===this.collection?!0:(this.unbindCollection(),this.collection=e,((t=this.collection)!=null?t.isObservable:void 0)?(this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},n.prototype.unbindCollection=function(){var e;if((e=this.collection)!=null?e.isObservable:void 0)return this.collection.forget("toArray",this.handleArrayChanged)},n.prototype.handleArrayChanged=function(){},n.prototype.die=function(){return this.unbindCollection(),n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;Batman.DOM.StyleBinding=function(i){function s(){this.setStyle=e(this.setStyle,this),this.handleArrayChanged=e(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},s.__super__.constructor.apply(this,arguments)}return n(s,i),s.SingleStyleBinding=function(e){function t(){var e,n,i;e=2<=arguments.length?r.call(arguments,0,i=arguments.length-1):(i=0,[]),n=arguments[i++],this.parent=n,t.__super__.constructor.apply(this,e)}return n(t,e),t.prototype.isTwoWay=function(){return!1},t.prototype.dataChange=function(e){return this.parent.setStyle(this.attributeName,e)},t}(Batman.DOM.AbstractAttributeBinding),s.prototype.dataChange=function(e){var n,i,s,o,u,a,f,l,c;if(!e){this.resetStyles();return}this.unbindCollection();if(typeof e=="string"){this.resetStyles(),f=e.split(";");for(u=0,a=f.length;u<a;u++)o=f[u],l=o.split(":"),i=l[0],n=2<=l.length?r.call(l,1):[],this.setStyle(i,n.join(":"));return}if(e instanceof Batman.Hash)return this.bindCollection(e);e instanceof Batman.Object&&(e=e.toJSON()),this.resetStyles(),c=[];for(s in e){if(!t.call(e,s))continue;c.push(this.bindSingleAttribute(s,""+this.keyPath+"."+s))}return c},s.prototype.handleArrayChanged=function(e){var t=this;return this.collection.forEach(function(e,n){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)})},s.prototype.bindSingleAttribute=function(e,t){return this.styleBindings[e]=new this.constructor.SingleStyleBinding(this.node,e,t,this.renderContext,this.renderer,this.only,this)},s.prototype.setStyle=function(e,t){e=Batman.helpers.camelize(e.trim(),!0),this.oldStyles[e]==null&&(this.oldStyles[e]=this.node.style[e]||"");if(t!=null?t.trim:void 0)t=t.trim();return t==null&&(t=""),this.node.style[e]=t},s.prototype.resetStyles=function(){var e,n,r,i;r=this.oldStyles,i=[];for(e in r){if(!t.call(r,e))continue;n=r[e],i.push(this.setStyle(e,n))}return i},s.prototype.resetBindings=function(){var e,t,n;n=this.styleBindings;for(e in n)t=n[e],t._fireDataChange(""),t.die();return this.styleBindings={}},s.prototype.unbindCollection=function(){return this.resetBindings(),s.__super__.unbindCollection.apply(this,arguments)},s}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.IteratorBinding=function(t){function r(t,n,i,s,o){var u,f=this;this.iteratorName=n,this.key=i,this.context=s,this.parentRenderer=o,this.handleArrayChanged=e(this.handleArrayChanged,this),this.nodeMap=new Batman.SimpleHash,this.rendererMap=new Batman.SimpleHash,this.fragment=document.createDocumentFragment(),this.prototypeNode=t.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),u=t.nextSibling,this.startNode=document.createComment("start "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode=document.createComment("end "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode[Batman.expando]=t[Batman.expando],Batman.canDeleteExpando&&delete t[Batman.expando],Batman.insertBefore(t.parentNode,this.startNode,u),Batman.insertBefore(t.parentNode,this.endNode,u),this.parentRenderer.prevent("rendered"),Batman.DOM.onParseExit(t.parentNode,function(){return Batman.destroyNode(t),f.bind(),f.parentRenderer.allowAndFire("rendered")}),r.__super__.constructor.call(this,this.endNode,this.iteratorName,this.key,this.context,this.parentRenderer)}return n(r,t),r.prototype.currentActionNumber=0,r.prototype.queuedActionNumber=0,r.prototype.bindImmediately=!1,r.prototype.parentNode=function(){return this.endNode.parentNode},r.prototype.die=function(){return this.dead=!0,r.__super__.die.apply(this,arguments)},r.prototype.dataChange=function(e){var t,n;if(e==null)return this.handleArrayChanged([]);if(!this.bindCollection(e))return t=(e!=null?e.forEach:void 0)?(n=[],e.forEach(function(e){return n.push(e)}),n):Object.keys(e),this.handleArrayChanged(t)},r.prototype.handleArrayChanged=function(e){var t,n,r,i,s,o,u,a,f,l,c=this;o=this.parentNode(),u=this._getStartNodeIndex()+1,a=this.nodeMap.merge();for(n=f=0,l=e.length;f<l;n=++f){r=e[n],s=o.childNodes[u+n];if(s!=null&&this._itemForNode(s)===r){a.unset(r);continue}i=(t=this.nodeMap.get(r))?(a.unset(r),t):this._newNodeForItem(r),Batman.insertBefore(this.parentNode(),i,s)}a.forEach(function(e,t){return c._removeItem(e)})},r.prototype._itemForNode=function(e){return Batman._data(e,""+this.iteratorName+"Item")},r.prototype._newNodeForItem=function(e){var t,n,r=this;return t=this.prototypeNode.cloneNode(!0),Batman._data(t,""+this.iteratorName+"Item",e),this.nodeMap.set(e,t),this.parentRenderer.prevent("rendered"),n=new Batman.Renderer(t,this.renderContext.descend(e,this.iteratorName),this.parentRenderer.view),n.on("rendered",function(){return Batman.propagateBindingEvents(t),r.fire("nodeAdded",t,e),r.parentRenderer.allowAndFire("rendered")}),t},r.prototype._getStartNodeIndex=function(){var e,t,n,r,i;i=this.parentNode().childNodes;for(e=n=0,r=i.length;n<r;e=++n){t=i[e];if(t===this.startNode)return e}return 0},r.prototype._removeItem=function(e){var t;return t=this.nodeMap.unset(e),Batman.destroyNode(t),this.fire("nodeRemoved",t,e)},r}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ClassBinding=function(r){function i(){return this.handleArrayChanged=e(this.handleArrayChanged,this),i.__super__.constructor.apply(this,arguments)}return n(i,r),i.prototype.dataChange=function(e){if(e!=null)return this.unbindCollection(),typeof e=="string"?this.node.className=e:(this.bindCollection(e),this.updateFromCollection())},i.prototype.updateFromCollection=function(){var e,n,r;if(this.collection)return e=this.collection.map?this.collection.map(function(e){return e}):function(){var e,i;e=this.collection,i=[];for(n in e){if(!t.call(e,n))continue;r=e[n],i.push(n)}return i}.call(this),e.toArray!=null&&(e=e.toArray()),this.node.className=e.join(" ")},i.prototype.handleArrayChanged=function(){return this.updateFromCollection()},i}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ValidationError=function(e){function n(e,t){n.__super__.constructor.call(this,{attribute:e,message:t})}return t(n,e),n.accessor("fullMessage",function(){return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}),n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.StorageAdapter=function(e){function r(e){var t;r.__super__.constructor.call(this,{model:e}),t=this.constructor,t.ModelMixin&&Batman.extend(e,t.ModelMixin),t.RecordMixin&&Batman.extend(e.prototype,t.RecordMixin)}return t(r,e),r.StorageError=function(e){function n(e){n.__super__.constructor.apply(this,arguments),this.message=e}return t(n,e),n.prototype.name="StorageError",n}(Error),r.RecordExistsError=function(e){function n(e){n.__super__.constructor.call(this,e||"Can't create this record because it already exists in the store!")}return t(n,e),n.prototype.name="RecordExistsError",n}(r.StorageError),r.NotFoundError=function(e){function n(e){n.__super__.constructor.call(this,e||"Record couldn't be found in storage!")}return t(n,e),n.prototype.name="NotFoundError",n}(r.StorageError),r.prototype.isStorageAdapter=!0,r.prototype.storageKey=function(e){var t;return t=(e!=null?e.constructor:void 0)||this.model,t.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(t.get("resourceName")))},r.prototype.getRecordFromData=function(e,t){var n;return t==null&&(t=this.model),n=new t,n._withoutDirtyTracking(function(){return this.fromJSON(e)}),n},r.skipIfError=function(e){return function(t,n){return t.error!=null?n():e.call(this,t,n)}},r.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))},r.prototype._inheritFilters=function(){var e,t,n,r,i,s;if(!this._batman.check(this)||!this._batman.filters){r=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}};if(r!=null){s=[];for(i in r)e=r[i],s.push(function(){var r;r=[];for(n in e)t=e[n],r.push(this._batman.filters[i][n]=t.slice(0));return r}.call(this));return s}}},r.prototype._addFilter=function(){var e,t,r,i,s,o,u,a;i=arguments[0],r=3<=arguments.length?n.call(arguments,1,o=arguments.length-1):(o=1,[]),e=arguments[o++],this._inheritFilters();for(u=0,a=r.length;u<a;u++)t=r[u],(s=this._batman.filters[i])[t]||(s[t]=[]),this._batman.filters[i][t].push(e);return!0},r.prototype.runFilter=function(e,t,n,r){var i,s,o,u,a=this;return this._inheritFilters(),s=this._batman.filters[e].all||[],i=this._batman.filters[e][t]||[],n.action=t,o=e==="before"?i.concat(s):s.concat(i),u=function(e){var t;return e!=null&&(n=e),(t=o.shift())!=null?t.call(a,n,u):r.call(a,n)},u()},r.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.runAfterFilter=function(e,t,n){return this.runFilter("after",e,t,this.exportResult(n))},r.prototype.exportResult=function(e){return function(t){return e(t.error,t.result,t)}},r.prototype._jsonToAttributes=function(e){return JSON.parse(e)},r.prototype.perform=function(e,t,n,r){var i,s,o=this;return n||(n={}),i={options:n,subject:t},s=function(t){return t!=null&&(i=t),o.runAfterFilter(e,i,r)},this.runBeforeFilter(e,i,function(t){return this[e](t,s)})},r}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice,r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Batman.RestStorage=function(e){function i(){i.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var s,o,u,a,f,l=this;t(i,e),i.JSONContentType="application/json",i.PostBodyContentType="application/x-www-form-urlencoded",i.BaseMixin={request:function(e,t,n){return n||(n=t,t={}),t.method||(t.method="GET"),t.action=e,this._doStorageOperation(t.method.toLowerCase(),t,n)}},i.ModelMixin=Batman.extend({},i.BaseMixin,{urlNestsUnder:function(){var e,t,r,i,s;t=1<=arguments.length?n.call(arguments,0):[],r={};for(i=0,s=t.length;i<s;i++)e=t[i],r[e+"_id"]=Batman.helpers.pluralize(e);return this.url=function(t){var n,i,s;n=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(e in r){s=r[e],i=t.data[e];if(i)return delete t.data[e],""+s+"/"+i+"/"+n}return n},this.prototype.url=function(){var t,n,i,s,o;t=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(e in r){s=r[e],i=this.get("dirtyKeys").get(e),i===void 0&&(i=this.get(e));if(i){o=""+s+"/"+i+"/"+t;break}}o||(o=t);if(n=this.get("id"))o+="/"+n;return o}}}),i.RecordMixin=Batman.extend({},i.BaseMixin),i.prototype.defaultRequestOptions={type:"json"},i.prototype._implicitActionNames=["create","read","update","destroy","readAll"],i.prototype.serializeAsForm=!0,i.prototype.recordJsonNamespace=function(e){return Batman.helpers.singularize(this.storageKey(e))},i.prototype.collectionJsonNamespace=function(e){return Batman.helpers.pluralize(this.storageKey(e.prototype))},i.prototype._execWithOptions=function(e,t,n){return typeof e[t]=="function"?e[t](n):e[t]},i.prototype._defaultCollectionUrl=function(e){return"/"+this.storageKey(e.prototype)},i.prototype._addParams=function(e,t){var n;return t&&t.action&&!(n=t.action,r.call(this._implicitActionNames,n)>=0)&&(e+="/"+t.action.toLowerCase()),e},i.prototype.urlForRecord=function(e,t){var n,r;if(e.url)r=this._execWithOptions(e,"url",t.options);else{r=e.constructor.url?this._execWithOptions(e.constructor,"url",t.options):this._defaultCollectionUrl(e.constructor);if(t.action!=="create"){if((n=e.get("id"))==null)throw new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!");r=r+"/"+n}}return r=this._addParams(r,t.options),this.urlPrefix(e,t)+r+this.urlSuffix(e,t)},i.prototype.urlForCollection=function(e,t){var n;return n=e.url?this._execWithOptions(e,"url",t.options):this._defaultCollectionUrl(e,t.options),n=this._addParams(n,t.options),this.urlPrefix(e,t)+n+this.urlSuffix(e,t)},i.prototype.urlPrefix=function(e,t){return this._execWithOptions(e,"urlPrefix",t.options)||""},i.prototype.urlSuffix=function(e,t){return this._execWithOptions(e,"urlSuffix",t.options)||""},i.prototype.request=function(e,t){var n;return n=Batman.extend(e.options,{autosend:!1,success:function(t){return e.data=t},error:function(t){return e.error=t},loaded:function(){return e.response=e.request.get("response"),t()}}),e.request=new Batman.Request(n),e.request.send()},i.prototype.perform=function(e,t,n,r){return n||(n={}),Batman.extend(n,this.defaultRequestOptions),i.__super__.perform.call(this,e,t,n,r)},i.prototype.before("all",i.skipIfError(function(e,t){if(!e.options.url)try{e.options.url=e.subject.prototype?this.urlForCollection(e.subject,e):this.urlForRecord(e.subject,e)}catch(n){e.error=n}return t()})),i.prototype.before("get","put","post","delete",i.skipIfError(function(e,t){return e.options.method=e.action.toUpperCase(),t()})),i.prototype.before("create","update",i.skipIfError(function(e,t){var n,r,i;return r=e.subject.toJSON(),(i=this.recordJsonNamespace(e.subject))?(n={},n[i]=r):n=r,e.options.data=n,t()})),i.prototype.before("create","update","put","post",i.skipIfError(function(e,t){return this.serializeAsForm?e.options.contentType=this.constructor.PostBodyContentType:e.options.data!=null&&(e.options.data=JSON.stringify(e.options.data),e.options.contentType=this.constructor.JSONContentType),t()})),i.prototype.after("all",i.skipIfError(function(e,t){var n;if(e.data==null)return t();if(typeof e.data=="string"){if(e.data.length>0)try{n=this._jsonToAttributes(e.data)}catch(r){return e.error=r,t()}}else typeof e.data=="object"&&(n=e.data);return n!=null&&(e.json=n),t()})),i.prototype.extractFromNamespace=function(e,t){return t&&e[t]!=null?e[t]:e},i.prototype.after("create","read","update",i.skipIfError(function(e,t){var n;return e.json!=null&&(n=this.extractFromNamespace(e.json,this.recordJsonNamespace(e.subject)),e.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})),e.result=e.subject,t()})),i.prototype.after("readAll",i.skipIfError(function(e,t){var n,r;return r=this.collectionJsonNamespace(e.subject),e.recordsAttributes=this.extractFromNamespace(e.json,r),Batman.typeOf(e.recordsAttributes)!=="Array"&&(r=this.recordJsonNamespace(e.subject.prototype),e.recordsAttributes=[this.extractFromNamespace(e.json,r)]),e.result=e.records=function(){var t,r,i,s;i=e.recordsAttributes,s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(this.getRecordFromData(n,e.subject));return s}.call(this),t()})),i.prototype.after("get","put","post","delete",i.skipIfError(function(e,t){var n,r;return e.json!=null&&(n=e.json,r=e.subject.prototype?this.collectionJsonNamespace(e.subject):this.recordJsonNamespace(e.subject),e.result=r&&e.json[r]!=null?e.json[r]:e.json),t()})),i.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},f=["create","read","update","destroy","readAll","get","post","put","delete"],o=function(e){return i.prototype[e]=i.skipIfError(function(t,n){var r;return(r=t.options).method||(r.method=this.constructor.HTTPMethods[e]),this.request(t,n)})};for(u=0,a=f.length;u<a;u++)s=f[u],o(s);return i}.call(this,Batman.StorageAdapter)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.LocalStorage=function(e){function n(){if(typeof window.localStorage=="undefined")return null;n.__super__.constructor.apply(this,arguments),this.storage=localStorage}return t(n,e),n.prototype.storageRegExpForRecord=function(e){return new RegExp("^"+this.storageKey(e)+"(\\d+)$")},n.prototype.nextIdForRecord=function(e){var t,n;return n=this.storageRegExpForRecord(e),t=1,this._forAllStorageEntries(function(e,r){var i;if(i=n.exec(e))return t=Math.max(t,parseInt(i[1],10)+1)}),t},n.prototype._forAllStorageEntries=function(e){var t,n,r,i;for(t=r=0,i=this.storage.length;0<=i?r<i:r>i;t=0<=i?++r:--r)n=this.storage.key(t),e.call(this,n,this.storage.getItem(n));return!0},n.prototype._storageEntriesMatching=function(e,t){var n,r;return n=this.storageRegExpForRecord(e.prototype),r=[],this._forAllStorageEntries(function(i,s){var o,u;if(u=n.exec(i)){o=this._jsonToAttributes(s),o[e.primaryKey]=u[1];if(this._dataMatches(t,o))return r.push(o)}}),r},n.prototype._dataMatches=function(e,t){var n,r,i;r=!0;for(n in e){i=e[n];if(t[n]!==i){r=!1;break}}return r},n.prototype.before("read","create","update","destroy",n.skipIfError(function(e,t){var n=this;return e.action==="create"?e.id=e.subject.get("id")||e.subject._withoutDirtyTracking(function(){return e.subject.set("id",n.nextIdForRecord(e.subject))}):e.id=e.subject.get("id"),e.id==null?e.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!"):e.key=this.storageKey(e.subject)+e.id,t()})),n.prototype.before("create","update",n.skipIfError(function(e,t){return e.recordAttributes=JSON.stringify(e.subject),t()})),n.prototype.after("read",n.skipIfError(function(e,t){if(typeof e.recordAttributes=="string")try{e.recordAttributes=this._jsonToAttributes(e.recordAttributes)}catch(n){return e.error=n,t()}return e.subject._withoutDirtyTracking(function(){return this.fromJSON(e.recordAttributes)}),t()})),n.prototype.after("read","create","update","destroy",n.skipIfError(function(e,t){return e.result=e.subject,t()})),n.prototype.after("readAll",n.skipIfError(function(e,t){var n;return e.result=e.records=function(){var t,r,i,s;i=e.recordsAttributes,s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(this.getRecordFromData(n,e.subject));return s}.call(this),t()})),n.prototype.read=n.skipIfError(function(e,t){return e.recordAttributes=this.storage.getItem(e.key),e.recordAttributes||(e.error=new this.constructor.NotFoundError),t()}),n.prototype.create=n.skipIfError(function(e,t){var n,r;return n=e.key,r=e.recordAttributes,this.storage.getItem(n)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(n,r),t()}),n.prototype.update=n.skipIfError(function(e,t){var n,r;return n=e.key,r=e.recordAttributes,this.storage.setItem(n,r),t()}),n.prototype.destroy=n.skipIfError(function(e,t){var n;return n=e.key,this.storage.removeItem(n),t()}),n.prototype.readAll=n.skipIfError(function(e,t){try{arguments[0].recordsAttributes=this._storageEntriesMatching(e.subject,e.options.data)}catch(n){arguments[0].error=n}return t()}),n}(Batman.StorageAdapter)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SessionStorage=function(e){function n(){if(typeof window.sessionStorage=="undefined")return null;n.__super__.constructor.apply(this,arguments),this.storage=sessionStorage}return t(n,e),n}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociationProxy=function(e){function n(e,t){this.association=e,this.model=t}return t(n,e),n.prototype.isProxy=!0,n.prototype.loaded=!1,n.prototype.toJSON=function(){var e;e=this.get("target");if(e!=null)return this.get("target").toJSON()},n.prototype.load=function(e){var t=this;return this.fetch(function(n,r){return n||(t.set("loaded",!0),t.set("target",r)),typeof e=="function"?e(n,r):void 0}),this.get("target")},n.prototype.fetch=function(e){var t;return(this.get("foreignValue")||this.get("primaryValue"))==null?e(void 0,void 0):(t=this.fetchFromLocal(),t?e(void 0,t):this.fetchFromRemote(e))},n.accessor("loaded",Batman.Property.defaultAccessor),n.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(e,t){return t}}),n.accessor({get:function(e){var t;return(t=this.get("target"))!=null?t.get(e):void 0},set:function(e,t){var n;return(n=this.get("target"))!=null?n.set(e,t):void 0}}),n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HasOneProxy=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},n.prototype.fetchFromRemote=function(e){var t,n=this;return t={},t[this.association.foreignKey]=this.get("primaryValue"),this.association.getRelatedModel().load(t,function(t,n){if(t)throw t;return!n||n.length<=0?e(new Error("Couldn't find related record!"),void 0):e(void 0,n[0])})},n}(Batman.AssociationProxy)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.BelongsToProxy=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},n.prototype.fetchFromRemote=function(e){var t=this;return this.association.getRelatedModel().find(this.get("foreignValue"),function(t,n){if(t)throw t;return e(void 0,n)})},n}(Batman.AssociationProxy)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicBelongsToProxy=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},n.prototype.fetchFromRemote=function(e){var t=this;return this.association.getRelatedModelForType(this.get("foreignTypeValue")).find(this.get("foreignValue"),function(t,n){if(t)throw t;return e(void 0,n)})},n}(Batman.BelongsToProxy)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.StateMachine=function(e){function r(e){this.nextEvents=[],this.set("_state",e)}return t(r,e),r.InvalidTransitionError=function(e){this.message=e!=null?e:""},r.InvalidTransitionError.prototype=new Error,r.transitions=function(e){var t,r,i,s,o,u,a,f,l,h,p=this;for(i in e){f=e[i];if(!f.from||!f.to)continue;s={},f.from.forEach?f.from.forEach(function(e){return s[e]=f.to}):s[f.from]=f.to,e[i]=s}this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,e),o=[],t=function(e){var t;t="is"+Batman.helpers.capitalize(e);if(p.prototype[t]!=null)return;return o.push(t),p.prototype[t]=function(){return this.get("state")===e}},h=this.prototype.transitionTable,l=function(e){return p.prototype[e]=function(){return this.startTransition(e)}};for(i in h){a=h[i];if(!!this.prototype[i])continue;l(i);for(r in a)u=a[r],t(r),t(u)}return o.length&&this.accessor.apply(this,n.call(o).concat([function(e){return this[e]()}])),this},r.accessor("state",function(){return this.get("_state")}),r.prototype.isTransitioning=!1,r.prototype.transitionTable={},r.prototype.onTransition=function(e,t,n){return this.on(""+e+"->"+t,n)},r.prototype.onEnter=function(e,t){return this.on("enter "+e,t)},r.prototype.onExit=function(e,t){return this.on("exit "+e,t)},r.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(e){var t,n;if(this.isTransitioning){this.nextEvents.push(e);return}return n=this.get("state"),t=this.nextStateForEvent(e),t?(this.isTransitioning=!0,this.fire("exit "+n),this.set("_state",t),this.fire(""+n+"->"+t),this.fire("enter "+t),this.fire(e),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1}),r.prototype.canStartTransition=function(e,t){return t==null&&(t=this.get("state")),!!this.nextStateForEvent(e,t)},r.prototype.nextStateForEvent=function(e,t){var n;return t==null&&(t=this.get("state")),(n=this.transitionTable[e])!=null?n[t]:void 0},r}(Batman.Object),Batman.DelegatingStateMachine=function(e){function n(e,t){this.base=t,n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.fire=function(){var e,t;return e=n.__super__.fire.apply(this,arguments),(t=this.base).fire.apply(t,arguments),e},n}(Batman.StateMachine)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;Batman.Model=function(t){function i(t){t==null&&(t={}),this.destroy=e(this.destroy,this),this.save=e(this.save,this),this.load=e(this.load,this),Batman.typeOf(t)==="Object"?i.__super__.constructor.call(this,t):(i.__super__.constructor.call(this),this.set("id",t))}var s,o,u,f,l,h,p;n(i,t),i.primaryKey="id",i.storageKey=null,i.persist=function(e,t){return Batman
.initializeObject(this.prototype),e=e.isStorageAdapter?e:new e(this),t&&Batman.mixin(e,t),this.prototype._batman.storage=e,e},i.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},i.encode=function(){var e,t,n,i,s,o,u,a,f,l,c,h,p,v;s=2<=arguments.length?r.call(arguments,0,f=arguments.length-1):(f=0,[]),t=arguments[f++],Batman.initializeObject(this.prototype),(u=this.prototype._batman).encoders||(u.encoders=new Batman.SimpleHash),(a=this.prototype._batman).decoders||(a.decoders=new Batman.SimpleHash),e={};switch(Batman.typeOf(t)){case"String":s.push(t);break;case"Function":e.encode=t;break;default:t.encode!=null&&(e.encode=t.encode),t.decode!=null&&(e.decode=t.decode)}e=Batman.extend({},this.defaultEncoder,e),v=["encode","decode"];for(l=0,h=v.length;l<h;l++){o=v[l];for(c=0,p=s.length;c<p;c++)i=s[c],n=this.prototype._batman[""+o+"rs"],e[o]?n.set(i,e[o]):n.unset(i)}},i.defaultEncoder={encode:function(e){return e},decode:function(e){return e}},i.observeAndFire("primaryKey",function(e,t){return this.encode(t,{encode:!1,decode:!1}),this.encode(e,{encode:!1,decode:this.defaultEncoder.decode})}),i.validate=function(){var e,t,n,i,s,o,u,a,f,l,c,h,p,v,m;e=2<=arguments.length?r.call(arguments,0,f=arguments.length-1):(f=0,[]),s=arguments[f++],Batman.initializeObject(this.prototype),u=(a=this.prototype._batman).validators||(a.validators=[]);if(typeof s=="function")return u.push({keys:e,callback:s});i=s,v=Batman.Validators,m=[];for(l=0,h=v.length;l<h;l++){o=v[l];if(n=o.matches(i)){for(c=0,p=n.length;c<p;c++)t=n[c],delete i[t];m.push(u.push({keys:e,validator:new o(n)}))}else m.push(void 0)}return m},i.LifecycleStateMachine=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.transitions({load:{empty:"loading",loaded:"loading",loading:"loading"},loaded:{loading:"loaded"},error:{loading:"error"}}),t}(Batman.DelegatingStateMachine),i.classAccessor("lifecycle",function(){var e;return this._batman.check(this),(e=this._batman).lifecycle||(e.lifecycle=new this.LifecycleStateMachine("empty",this))}),i.classAccessor("resourceName",{get:function(){return this.resourceName!=null?this.resourceName:(!Batman.config.minificationErrors,Batman.helpers.underscore(Batman.functionName(this)))}}),i.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(e,t){return this.set("loaded",t)}}),i.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(e,t){return this._loaded=t}}),i.classAccessor("first",function(){return this.get("all").toArray()[0]}),i.classAccessor("last",function(){var e;return e=this.get("all").toArray(),e[e.length-1]}),i.clear=function(){var e,t;return Batman.initializeObject(this),e=this.get("loaded").clear(),(t=this._batman.get("associations"))!=null&&t.reset(),e},i.find=function(e,t){var n;return n=new this,n._withoutDirtyTracking(function(){return this.set("id",e)}),n.load(t),n},i.load=function(e,t){var n,r,i=this;if((r=typeof e)==="function"||r==="undefined")t=e,e={};return n=this.get("lifecycle"),n.load()?this._doStorageOperation("readAll",{data:e},function(e,r,s){var o,u;return e!=null?(n.error(),typeof t=="function"?t(e,[]):void 0):(o=function(){var e,t,n;n=[];for(e=0,t=r.length;e<t;e++)u=r[e],n.push(this._mapIdentity(u));return n}.call(i),n.loaded(),typeof t=="function"?t(e,o,s):void 0)}):t(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+n.get("state")))},i.create=function(e,t){var n,r;return t||(r=[{},e],e=r[0],t=r[1]),n=new this(e),n.save(t),n},i.findOrCreate=function(e,t){var n,r;return r=new this(e),r.isNew()?r.save(t):(n=this._mapIdentity(r),t(void 0,n)),r},i._mapIdentity=function(e){var t,n,r;return typeof (n=e.get("id"))=="undefined"||n===""?e:(t=(r=this.get("loaded.indexedBy.id").get(n))!=null?r.toArray()[0]:void 0,t?(t._withoutDirtyTracking(function(){var t;return this.updateAttributes(((t=e.get("attributes"))!=null?t.toObject():void 0)||{})}),t):(this.get("loaded").add(e),e))},i._doStorageOperation=function(e,t,n){var r;return r=this.prototype._batman.get("storage"),r.perform(e,this,t,n)},h=["find","load","create"];for(o=0,f=h.length;o<f;o++)s=h[o],i[s]=Batman.Property.wrapTrackingPrevention(i[s]);i.InstanceLifecycleStateMachine=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),t}(Batman.DelegatingStateMachine),i.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),i.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),i.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),i.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),i.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),i.accessor("isNew",function(){return this.isNew()}),i.accessor(i.defaultAccessor={get:function(e){return Batman.getPath(this,["attributes",e])},set:function(e,t){return this._willSet(e)?this.get("attributes").set(e,t):this.get(e)},unset:function(e){return this.get("attributes").unset(e)}}),i.wrapAccessor("id",function(e){return{get:function(){var t;return t=this.constructor.primaryKey,t==="id"?e.get.apply(this,arguments):this.get(t)},set:function(t,n){var r,i;return typeof n=="string"&&n.match(/[^0-9]/)===null&&""+(r=parseInt(n,10))===n&&(n=r),i=this.constructor.primaryKey,i==="id"?(this._willSet(t),e.set.apply(this,arguments)):this.set(i,n)}}}),i.prototype.isNew=function(){return typeof this.get("id")=="undefined"},i.prototype.updateAttributes=function(e){return this.mixin(e),this},i.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},i.prototype.toParam=function(){return this.get("id")},i.prototype.toJSON=function(){var e,t,n=this;return t={},e=this._batman.get("encoders"),!!e&&!e.isEmpty()&&e.forEach(function(e,r){var i,s;s=n.get(e);if(typeof s!="undefined"){i=r(s,e,t,n);if(typeof i!="undefined")return t[e]=i}}),t},i.prototype.fromJSON=function(e){var t,n,r,i,s=this;r={},t=this._batman.get("decoders");if(!t||t.isEmpty())for(n in e)i=e[n],r[n]=i;else t.forEach(function(t,n){if(typeof e[t]!="undefined")return r[t]=n(e[t],t,e,r,s)});return this.constructor.primaryKey!=="id"&&(r.id=e[this.constructor.primaryKey]),this.mixin(r)},i.prototype.hasStorage=function(){return this._batman.get("storage")!=null},i.prototype.load=function(e,t){var n,r,i,s,o=this;t||(i=[{},e],e=i[0],t=i[1]),r=Object.keys(e).length!==0;if((s=this.get("lifecycle.state"))==="destroying"||s==="destroyed"){typeof t=="function"&&t(new Error("Can't load a destroyed record!"));return}if(this.get("lifecycle").load())return n=[],t!=null&&n.push(t),r||(this._currentLoad=n),this._doStorageOperation("read",{data:e},function(e,i,s){var u,a;e?o.get("lifecycle").error():(o.get("lifecycle").loaded(),i=o.constructor._mapIdentity(i)),r||(o._currentLoad=null);for(u=0,a=n.length;u<a;u++)t=n[u],t(e,i,s)});if(this.get("lifecycle.state")!=="loading"||!!r)return typeof t=="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0;if(t!=null)return this._currentLoad.push(t)},i.prototype.save=function(e,t){var n,r,i,s,o,u,a,f=this;t||(o=[{},e],e=o[0],t=o[1]);if((u=this.get("lifecycle").get("state"))==="destroying"||u==="destroyed"){typeof t=="function"&&t(new Error("Can't save a destroyed record!"));return}return r=this.isNew(),a=r?["create","create","created"]:["save","update","saved"],i=a[0],s=a[1],n=a[2],this.validate(function(r,o){var u,a;if(r||o.length){f.get("lifecycle").failedValidation(),typeof t=="function"&&t(r||o,f);return}return a=f.isNew(),f.get("lifecycle").startTransition(i)?(u=f.constructor._batman.get("associations"),f._withoutDirtyTracking(function(){var e,t=this;return u!=null?(e=u.getByType("belongsTo"))!=null?e.forEach(function(e,n){return e.apply(t)}):void 0:void 0}),f._doStorageOperation(s,{data:e},function(e,r,i){return e?e instanceof Batman.ErrorsSet?f.get("lifecycle").failedValidation():f.get("lifecycle").error():(f.get("dirtyKeys").clear(),f.get("_dirtiedKeys").clear(),u&&r._withoutDirtyTracking(function(){var t,n;return(t=u.getByType("hasOne"))!=null&&t.forEach(function(t,n){return t.apply(e,r)}),(n=u.getByType("hasMany"))!=null?n.forEach(function(t,n){return t.apply(e,r)}):void 0}),r=f.constructor._mapIdentity(r),f.get("lifecycle").startTransition(n)),typeof t=="function"?t(e,r||f,i):void 0})):typeof t=="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+f.get("lifecycle.state"))):void 0})},i.prototype.destroy=function(e,t){var n,r=this;return t||(n=[{},e],e=n[0],t=n[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:e},function(e,n,i){return e?r.get("lifecycle").error():(r.constructor.get("loaded").remove(r),r.get("lifecycle").destroyed()),typeof t=="function"?t(e,n,i):void 0}):typeof t=="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},i.prototype.validate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;r=this.get("errors"),r.clear(),u=this._batman.get("validators")||[];if(!u||u.length===0)return typeof e=="function"&&e(void 0,r),!0;n=u.length,i=function(){if(--n===0)return typeof e=="function"?e(void 0,r):void 0};for(a=0,l=u.length;a<l;a++){o=u[a],h=o.keys;for(f=0,c=h.length;f<c;f++){s=h[f],t=[r,this,s,i];try{o.validator?o.validator.validateEach.apply(o.validator,t):o.callback.apply(o,t)}catch(p){typeof e=="function"&&e(p,r)}}}},i.prototype.associationProxy=function(e){var t,n,r;return Batman.initializeObject(this),t=(n=this._batman).associationProxies||(n.associationProxies={}),t[r=e.label]||(t[r]=new e.proxyClass(e,this)),t[e.label]},i.prototype._willSet=function(e){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(e)||(this.set("dirtyKeys."+e,this.get(e)),this.get("_dirtiedKeys").add(e)),!0):!1},i.prototype._doStorageOperation=function(e,t,n){var r,i=this;return r=this._batman.get("storage"),r.perform(e,this,t,function(){return n.apply(null,arguments)})},i.prototype._withoutDirtyTracking=function(e){var t;return this._pauseDirtyTracking=!0,t=e.call(this),this._pauseDirtyTracking=!1,t},p=["load","save","validate","destroy"];for(u=0,l=p.length;u<l;u++)s=p[u],i.prototype[s]=Batman.Property.wrapTrackingPrevention(i.prototype[s]);return i}.call(this,Batman.Object)}.call(this),function(){var e,t,n,r,i,s=this;i=Batman.AssociationCurator.availableAssociations,t=function(e){return Batman.Model[e]=function(t,n){var r,i;return Batman.initializeObject(this),r=(i=this._batman).associations||(i.associations=new Batman.AssociationCurator(this)),r.add(new(Batman[""+Batman.helpers.capitalize(e)+"Association"])(this,t,n))}};for(n=0,r=i.length;n<r;n++)e=i[n],t(e)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ParamsReplacer=function(e){function n(e,t){this.navigator=e,this.params=t}return t(n,e),n.prototype.redirect=function(){return this.navigator.replace(this.toObject())},n.prototype.replace=function(e){return this.params.replace(e),this.redirect()},n.prototype.update=function(e){return this.params.update(e),this.redirect()},n.prototype.clear=function(){return this.params.clear(),this.redirect()},n.prototype.toObject=function(){return this.params.toObject()},n.accessor({get:function(e){return this.params.get(e)},set:function(e,t){var n,r;return n=this.params.get(e),r=this.params.set(e,t),n!==t&&this.redirect(),r},unset:function(e){var t,n;return t=this.params.hasKey(e),n=this.params.unset(e),t&&this.redirect(),n}}),n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ParamsPusher=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.redirect=function(){return this.navigator.push(this.toObject())},n}(Batman.ParamsReplacer)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.NamedRouteQuery=function(e){function n(e,t){var r;t==null&&(t=[]),n.__super__.constructor.call(this,{routeMap:e,args:t});for(r in this.get("routeMap").childrenByName)this[r]=this._queryAccess.bind(this,r)}return t(n,e),n.prototype.isNamedRouteQuery=!0,n.accessor("route",function(){var e,t,n,r,i,s,o;s=this.get("routeMap"),t=s.memberRoute,e=s.collectionRoute,o=[t,e];for(r=0,i=o.length;r<i;r++){n=o[r];if(n!=null&&n.namedArguments.length===this.get("args").length)return n}return e||t}),n.accessor("path",function(){return this.path()}),n.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),n.accessor({get:function(e){if(e==null)return;return typeof e=="string"?this.nextQueryForName(e):this.nextQueryWithArgument(e)},cache:!1}),n.accessor("withHash",function(){var e=this;return new Batman.Accessible(function(t){return e.withHash(t)})}),n.prototype.withHash=function(e){var t;return t=this.clone(),t.set("hashValue",e),t},n.prototype.nextQueryForName=function(e){var t;if(t=this.get("routeMap").childrenByName[e])return new Batman.NamedRouteQuery(t,this.args)},n.prototype.nextQueryWithArgument=function(e){var t;return t=this.args.slice(0),t.push(e),this.clone(t)},n.prototype.path=function(){var e,t,n,r,i,s,o;i={},r=this.get("route.namedArguments");for(n=s=0,o=r.length;s<o;n=++s)e=r[n],(t=this.get("args")[n])!=null&&(i[e]=this._toParam(t));return this.get("hashValue")!=null&&(i["#"]=this.get("hashValue")),this.get("route").pathFromParams(i)},n.prototype.toString=function(){return this.path()},n.prototype.clone=function(e){return e==null&&(e=this.args),new Batman.NamedRouteQuery(this.routeMap,e)},n.prototype._toParam=function(e){return e instanceof Batman.AssociationProxy&&(e=e.get("target")),(e!=null?e.toParam:void 0)!=null?e.toParam():e},n.prototype._queryAccess=function(e,t){var n;return n=this.nextQueryForName(e),t!=null&&(n=n.nextQueryWithArgument(t)),n},n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Dispatcher=function(e){function n(e,t){n.__super__.constructor.call(this,{app:e,routeMap:t})}var r;return t(n,e),n.canInferRoute=function(e){return e instanceof Batman.Model||e instanceof Batman.AssociationProxy||e.prototype instanceof Batman.Model},n.paramsFromArgument=function(e){var t;return t=function(e){return Batman.helpers.camelize(Batman.helpers.pluralize(e.get("resourceName")),!0)},this.canInferRoute(e)?e instanceof Batman.Model||e instanceof Batman.AssociationProxy?(e.isProxy&&(e=e.get("target")),e!=null?{controller:t(e.constructor),action:"show",id:e.get("id")}:{}):e.prototype instanceof Batman.Model?{controller:t(e),action:"index"}:e:e},r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor("__app",Batman.Property.defaultAccessor),n.accessor(function(e){return this.get("__app."+Batman.helpers.capitalize(e)+"Controller.sharedController")}),n}(Batman.Object),n.accessor("controllers",function(){return new r({__app:this.get("app")})}),n.prototype.routeForParams=function(e){return e=this.constructor.paramsFromArgument(e),this.get("routeMap").routeForParams(e)},n.prototype.pathFromParams=function(e){var t;return typeof e=="string"?e:(e=this.constructor.paramsFromArgument(e),(t=this.routeForParams(e))!=null?t.pathFromParams(e):void 0)},n.prototype.dispatch=function(e){var t,n,r,i;t=this.constructor.paramsFromArgument(e),r=this.routeForParams(t);if(r)i=r.pathAndParamsFromArgument(t),n=i[0],e=i[1],this.set("app.currentRoute",r),this.set("app.currentURL",n),this.get("app.currentParams").replace(e||{}),r.dispatch(e);else{if(Batman.typeOf(e)==="Object"&&!this.constructor.canInferRoute(e))return this.get("app.currentParams").replace(e);this.get("app.currentParams").clear();if(e!=="/404")return Batman.redirect("/404")}return n},n}.call(this,Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Route=function(e){function n(e,t){var r,i,s,o,u,a,f,l,h,p;f=this.constructor.regexps,e.indexOf("/")!==0&&(e="/"+e),o=e.replace(f.escapeRegExp,"\\$&"),a=RegExp("^"+o.replace(f.namedParam,"([^/]+)").replace(f.splatParam,"(.*?)")+f.queryParam+"$"),s=function(){var e;e=[];while(i=f.namedOrSplat.exec(o))e.push(i[1]);return e}(),u={templatePath:e,pattern:o,regexp:a,namedArguments:s,baseParams:t},p=this.optionKeys;for(l=0,h=p.length;l<h;l++)r=p[l],u[r]=t[r],delete t[r];n.__super__.constructor.call(this,u)}return t(n,e),n.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g},n.prototype.optionKeys=["member","collection"],n.prototype.testKeys=["controller","action"],n.prototype.isRoute=!0,n.prototype.paramsFromPath=function(e){var t,n,r,i,s,o,u,a,f;u=new Batman.URI(e),s=this.get("namedArguments"),o=Batman.extend({path:u.path},this.get("baseParams")),r=this.get("regexp").exec(u.path).slice(1);for(t=a=0,f=r.length;a<f;t=++a)n=r[t],i=s[t],o[i]=n;return Batman.extend(o,u.queryParams)},n.prototype.pathFromParams=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;s=Batman.extend({},e),o=this.get("templatePath"),p=this.get("namedArguments");for(f=0,c=p.length;f<c;f++)r=p[f],a=RegExp(""+this.constructor.regexps.namePrefix+r),i=o.replace(a,s[r]!=null?s[r]:""),i!==o&&(delete s[r],o=i);d=this.testKeys;for(l=0,h=d.length;l<h;l++)n=d[l],delete s[n];return s["#"]&&(t=s["#"],delete s["#"]),u=Batman.URI.queryFromParams(s),u&&(o+="?"+u),t&&(o+="#"+t),o},n.prototype.test=function(e){var t,n,r,i,s,o;if(typeof e=="string")n=e;else if(e.path!=null)n=e.path;else{n=this.pathFromParams(e),o=this.testKeys;for(i=0,s=o.length;i<s;i++){t=o[i];if((r=this.get(t))!=null&&e[t]!==r)return!1}}return this.get("regexp").test(n)},n.prototype.pathAndParamsFromArgument=function(e){var t,n;return typeof e=="string"?(t=this.paramsFromPath(e),n=e):(t=e,n=this.pathFromParams(e)),[n,t]},n.prototype.dispatch=function(e){return this.test(e)?this.get("callback")(e):!1},n.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},n}(Batman.Object)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ControllerActionRoute=function(t){function r(t,n){this.callback=e(this.callback,this);var i,s,o;n.signature&&(o=n.signature.split("#"),s=o[0],i=o[1],i||(i="index"),n.controller=s,n.action=i,delete n.signature),r.__super__.constructor.call(this,t,n)}return n(r,t),r.prototype.optionKeys=["member","collection","app","controller","action"],r.prototype.callback=function(e){var t;return t=this.get("app.dispatcher.controllers."+this.get("controller")),t.dispatch(this.get("action"),e)},r}(Batman.Route)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.CallbackActionRoute=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.optionKeys=["member","collection","callback","app"],n.prototype.controller=!1,n.prototype.action=!1,n}(Batman.Route)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.Hash=function(e){function r(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),r.__super__.constructor.apply(this,arguments)}var i,s,o,u,a,f,l,h,p=this;t(r,e),r.Metadata=function(e){function n(e){this.hash=e}return t(n,e),Batman.extend(n.prototype,Batman.Enumerable),n.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),n.accessor("isEmpty","keys","toArray",function(e){return this.hash.registerAsMutableSource(),this.hash[e]()}),n.prototype.forEach=function(){var e;return(e=this.hash).forEach.apply(e,arguments)},n}(Batman.Object),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.defaultAccessor={get:Batman.SimpleHash.prototype.get,set:r.mutation(function(e,t){var n;return n=Batman.SimpleHash.prototype.set.call(this,e,t),this.fire("itemsWereAdded",e),n}),unset:r.mutation(function(e){var t;return t=Batman.SimpleHash.prototype.unset.call(this,e),t!=null&&this.fire("itemsWereRemoved",e),t}),cache:!1},r.accessor(r.defaultAccessor),r.prototype._preventMutationEvents=function(e){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return e.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},r.prototype.clear=r.mutation(function(){var e,t;return e=this.keys(),this._preventMutationEvents(function(){var e=this;return this.forEach(function(t){return e.unset(t)})}),t=Batman.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(n.call(e))),t}),r.prototype.update=r.mutation(function(e){var t;t=[],this._preventMutationEvents(function(){var n=this;return Batman.forEach(e,function(e,r){return n.hasKey(e)||t.push(e),n.set(e,r)})});if(t.length>0)return this.fire.apply(this,["itemsWereAdded"].concat(n.call(t)))}),r.prototype.replace=r.mutation(function(e){var t,r;t=[],r=[],this._preventMutationEvents(function(){var n=this;return this.forEach(function(t,i){if(!Batman.objectHasKey(e,t))return n.unset(t),r.push(t)}),Batman.forEach(e,function(e,r){return n.hasKey(e)||t.push(e),n.set(e,r)})}),t.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(n.call(t)));if(r.length>0)return this.fire.apply(this,["itemsWereRemoved"].concat(n.call(r)))}),l=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"];for(o=0,a=l.length;o<a;o++)i=l[o],r.prototype[i]=Batman.SimpleHash.prototype[i];h=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],s=function(e){return r.prototype[e]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[e].apply(this,arguments)}};for(u=0,f=h.length;u<f;u++)i=h[u],s(i);return r}.call(this,Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.RenderCache=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return t(n,e),n.prototype.maximumLength=4,n.prototype.viewForOptions=function(e){var t=this;return e.cache===!1||e.viewClass.prototype.cache===!1?this._newViewFromOptions(e):this.getOrSet(e,function(){return t._newViewFromOptions(Batman.extend({},e))})},n.prototype._newViewFromOptions=function(e){return new e.viewClass(e)},n.wrapAccessor(function(e){return{cache:!1,get:function(t){var n;return n=e.get.call(this,t),n&&this._addOrBubbleKey(t),n},set:function(t,n){var r;return r=e.set.apply(this,arguments),r.set("cached",!0),this._addOrBubbleKey(t),this._evictExpiredKeys(),r},unset:function(t){var n;return n=e.unset.apply(this,arguments),n.set("cached",!1),this._removeKeyFromQueue(t),n}}}),n.prototype.equality=function(e,t){var n;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(n in e)if(n!=="view"&&e[n]!==t[n])return!1;return!0},n.prototype.reset=function(){var e,t,n,r,i;r=this.keyQueue.slice(0),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.unset(e));return i},n.prototype._addOrBubbleKey=function(e){return this._removeKeyFromQueue(e),this.keyQueue.unshift(e)},n.prototype._removeKeyFromQueue=function(e){var t,n,r,i,s;s=this.keyQueue;for(t=r=0,i=s.length;r<i;t=++r){n=s[t];if(this.equality(n,e)){this.keyQueue.splice(t,1);break}}return e},n.prototype._evictExpiredKeys=function(){var e,t,n,r,i,s;if(this.length>this.maximumLength){e=this.keyQueue.slice(0);for(t=r=i=this.maximumLength,s=e.length;i<=s?r<s:r>s;t=i<=s?++r:--r)n=e[t],this.get(n).isInDOM()||this.unset(n)}},n}(Batman.Hash)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Batman.Controller=function(t){function i(){this.redirect=e(this.redirect,this),i.__super__.constructor.apply(this,arguments),this._resetActionFrames()}var s;return n(i,t),i.singleton("sharedController"),i.wrapAccessor("routingKey",function(e){return{get:function(){return this.routingKey!=null?this.routingKey:(!Batman.config.minificationErrors,Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),i.accessor("_renderContext",function(){return Batman.RenderContext.root().descend(this)}),s=function(e,t){return t?typeof e=="string"?e={only:[e]}:(e.only&&Batman.typeOf(e.only)!=="Array"&&(e.only=[e.only]),e.except&&Batman.typeOf(e.except)!=="Array"&&(e.except=[e.except])):(t=e,e={}),e.block=t,e},i.beforeFilter=function(){var e,t,n;return Batman.initializeObject(this),t=s.apply(null,arguments),e=(n=this._batman).beforeFilters||(n.beforeFilters=new Batman.SimpleHash),e.set(t.block,t)},i.afterFilter=function(){var e,t,n;return Batman.initializeObject(this),t=s.apply(null,arguments),e=(n=this._batman).afterFilters||(n.afterFilters=new Batman.SimpleHash),e.set(t.block,t)},i.afterFilter(function(e){if(this.autoScrollToHash&&e["#"]!=null)return this.scrollToHash(e["#"])}),i.prototype.renderCache=new Batman.RenderCache,i.prototype.defaultRenderYield="main",i.prototype.autoScrollToHash=!0,i.prototype.dispatch=function(e,t){var n;t==null&&(t={}),t.controller||(t.controller=this.get("routingKey")),t.action||(t.action=e),t.target||(t.target=this),this._resetActionFrames(),this.set("action",e),this.set("params",t),Batman.DOM.Yield.cycleAll(),this.executeAction(e,t),Batman.DOM.Yield.clearAllStale(),n=this._afterFilterRedirect,delete this._afterFilterRedirect;if(n)return Batman.redirect(n)},i.prototype.executeAction=function(e,t){var n,r,i,s,o,u,a=this;return t==null&&(t=this.get("params")),i=this._actionFrames[this._actionFrames.length-1],n=new Batman.ControllerActionFrame({parentFrame:i,action:e},function(){var n;return a._runFilters(e,t,"afterFilters"),a._resetActionFrames(),(n=Batman.navigator)!=null?n.redirect=r:void 0}),this._actionFrames.push(n),n.startOperation({internal:!0}),r=(o=Batman.navigator)!=null?o.redirect:void 0,(u=Batman.navigator)!=null&&(u.redirect=this.redirect),this._runFilters(e,t,"beforeFilters"),s=this[e](t),n.operationOccurred||this.render(),n.finishOperation(),s},i.prototype.redirect=function(e){var t;t=this._actionFrames[this._actionFrames.length-1];if(!t)return Batman.typeOf(e)==="Object"&&(e.controller||(e.controller=this)),Batman.redirect(e);!t.operationOccurred,t.startAndFinishOperation();if(this._afterFilterRedirect==null)return this._afterFilterRedirect=e},i.prototype.render=function(e){var t,n,r,i,s,o=this;e==null&&(e={}),(n=(i=this._actionFrames)!=null?i[this._actionFrames.length-1]:void 0)&&n.startOperation();if(e===!1){n.finishOperation();return}return t=(n!=null?n.action:void 0)||this.get("action"),e&&(e.into||(e.into=this.defaultRenderYield)),e.view?(r=e.view,e.view=null):(e.viewClass||(e.viewClass=this._viewClassForAction(t)),e.context||(e.context=this.get("_renderContext")),e.source||(e.source=Batman.helpers.underscore(this.get("routingKey")+"/"+t)),r=this.renderCache.viewForOptions(e)),r&&((s=Batman.currentApp)!=null&&s.prevent("ready"),r.on("ready",function(){var t;return Batman.DOM.Yield.withName(e.into).replace(r.get("node")),(t=Batman.currentApp)!=null&&t.allowAndFire("ready"),n!=null?n.finishOperation():void 0})),r},i.prototype.scrollToHash=function(e){return e==null&&(e=this.get("params")["#"]),Batman.DOM.scrollIntoView(e)},i.prototype._resetActionFrames=function(){return this._actionFrames=[]},i.prototype._viewClassForAction=function(e){var t,n;return t=this.get("routingKey").replace("/","_"),((n=Batman.currentApp)!=null?n[Batman.helpers.camelize(""+t+"_"+e+"_view")]:void 0)||Batman.View},i.prototype._runFilters=function(e,t,n){var i,s=this;if(n=(i=this.constructor._batman)!=null?i.get(n):void 0)return n.forEach(function(n,i){var o;if(i.only&&r.call(i.only,e)<0)return;if(i.except&&r.call(i.except,e)>=0)return;return o=i.block,typeof o=="function"?o.call(s,t):typeof s[o]=="function"?s[o](t):void 0})},i}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Set=function(e){function n(){Batman.SimpleSet.apply(this,arguments)}var r,i,s,o,u,a,f,l,c=this;t(n,e),Batman.extend(n.prototype,Batman.Enumerable),n._applySetAccessors=function(e){var t,n,r,i;n={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.indexedBy(t)})},indexedByUnique:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.indexedByUnique(t)})},sortedBy:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.sortedBy(t)})},sortedByDescending:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.sortedBy(t,"desc")})}},i=[];for(r in n)t=n[r],i.push(e.accessor(r,t));return i},n._applySetAccessors(n),f=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"];for(s=0,u=f.length;s<u;s++)r=f[s],n.prototype[r]=Batman.SimpleSet.prototype[r];l=["find","merge","forEach","toArray","isEmpty","has"],i=function(e){return n.prototype[e]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[e].apply(this,arguments)}};for(o=0,a=l.length;o<a;o++)r=l[o],i(r);return n.prototype.toJSON=n.prototype.toArray,n}.call(this,Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ErrorsSet=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor(function(e){return this.indexedBy("attribute").get(e)}),n.prototype.add=function(e,t){return n.__super__.add.call(this,new Batman.ValidationError(e,t))},n}(Batman.Set)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetProxy=function(e){function r(e){var t=this;this.base=e,r.__super__.constructor.call(this),this.length=this.base.length,this.base.on("itemsWereAdded",function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],t.set("length"
,t.base.length),t.fire.apply(t,["itemsWereAdded"].concat(n.call(e)))}),this.base.on("itemsWereRemoved",function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],t.set("length",t.base.length),t.fire.apply(t,["itemsWereRemoved"].concat(n.call(e)))})}var i,s,o,u,a,f=this;t(r,e),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.filter=function(e){var t;return t=new Batman.Set,this.reduce(function(t,n){return e(n)&&t.add(n),t},t)},r.prototype.replace=function(){var e,t;return e=this.property("length"),e.isolate(),t=this.base.replace.apply(this,arguments),e.expose(),t},a=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],s=function(e){return r.prototype[e]=function(){var t;return(t=this.base)[e].apply(t,arguments)}};for(o=0,u=a.length;o<u;o++)i=a[o],s(i);return Batman.Set._applySetAccessors(r),r.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(e,t){return this.length=t}}),r}.call(this,Batman.Object)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;Batman.BinarySetOperation=function(t){function i(t,n){this.left=t,this.right=n,this._setup=e(this._setup,this),i.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return n(i,t),i.prototype._setup=function(e,t){var n=this;return e.on("itemsWereAdded",function(){var i;return i=1<=arguments.length?r.call(arguments,0):[],n._itemsWereAddedToSource.apply(n,[e,t].concat(r.call(i)))}),e.on("itemsWereRemoved",function(){var i;return i=1<=arguments.length?r.call(arguments,0):[],n._itemsWereRemovedFromSource.apply(n,[e,t].concat(r.call(i)))}),this._itemsWereAddedToSource.apply(this,[e,t].concat(r.call(e.toArray())))},i.prototype.merge=function(){var e,t,n,i,s;t=1<=arguments.length?r.call(arguments,0):[],e=new Batman.Set,t.unshift(this);for(i=0,s=t.length;i<s;i++)n=t[i],n.forEach(function(t){return e.add(t)});return e},i.prototype.filter=Batman.SetProxy.prototype.filter,i}(Batman.Set)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetUnion=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype._itemsWereAddedToSource=function(){var e,t,r;return r=arguments[0],t=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],this.add.apply(this,e)},r.prototype._itemsWereRemovedFromSource=function(){var e,t,r,i,s;return s=arguments[0],i=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],r=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.has(e)||s.push(e);return s}(),this.remove.apply(this,r)},r}(Batman.BinarySetOperation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetIntersection=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype._itemsWereAddedToSource=function(){var e,t,r,i,s;return s=arguments[0],i=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],r=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.has(e)&&s.push(e);return s}(),this.add.apply(this,r)},r.prototype._itemsWereRemovedFromSource=function(){var e,t,r;return r=arguments[0],t=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],this.remove.apply(this,e)},r}(Batman.BinarySetOperation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetComplement=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype._itemsWereAddedToSource=function(){var e,t,r,i,s,o;return o=arguments[0],s=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],o===this.left?(r=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],s.has(e)||i.push(e);return i}(),this.add.apply(this,r)):(i=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],s.has(e)&&i.push(e);return i}(),this.remove.apply(this,i))},r.prototype._itemsWereRemovedFromSource=function(){var e,t,r,i,s;return s=arguments[0],i=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],s===this.left?this.remove.apply(this,t):(r=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.has(e)&&s.push(e);return s}(),this.add.apply(this,r))},r.prototype._addComplement=function(e,t){var n;return this.add.apply(this,function(){var r,i,s;s=[];for(r=0,i=e.length;r<i;r++)n=e[r],t.has(n)&&s.push(n);return s}())},r}(Batman.BinarySetOperation)}.call(this),function(){Batman.mixins=new Batman.Object}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Accessible=function(e){function n(){this.accessor.apply(this,arguments)}return t(n,e),n}(Batman.Object),Batman.TerminalAccessible=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.propertyClass=Batman.Property,n}(Batman.Accessible)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetObserver=function(e){function r(e){var t=this;this.base=e,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return t.fire.apply(t,["itemsWereAdded"].concat(n.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return t.fire.apply(t,["itemsWereRemoved"].concat(n.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return t(r,e),r.prototype.observedItemKeys=[],r.prototype.observerForItemAndKey=function(e,t){},r.prototype._getOrSetObserverForItemAndKey=function(e,t){var n=this;return this._itemObservers.getOrSet(e,function(){var r;return r=new Batman.SimpleHash,r.getOrSet(t,function(){return n.observerForItemAndKey(e,t)})})},r.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},r.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},r.prototype.startObservingItems=function(){var e,t,r,i,s;t=1<=arguments.length?n.call(arguments,0):[],s=[];for(r=0,i=t.length;r<i;r++)e=t[r],s.push(this._manageObserversForItem(e,"observe"));return s},r.prototype.stopObservingItems=function(){var e,t,r,i,s;t=1<=arguments.length?n.call(arguments,0):[],s=[];for(r=0,i=t.length;r<i;r++)e=t[r],s.push(this._manageObserversForItem(e,"forget"));return s},r.prototype._manageObserversForItem=function(e,t){var n,r,i,s;if(!e.isObservable)return;s=this.observedItemKeys;for(r=0,i=s.length;r<i;r++)n=s[r],e[t](n,this._getOrSetObserverForItemAndKey(e,n));if(t==="forget")return this._itemObservers.unset(e)},r.prototype._manageItemObservers=function(e){var t=this;return this.base.forEach(function(n){return t._manageObserversForItem(n,e)})},r.prototype._manageSetObservers=function(e){var t=this;if(!this.base.isObservable)return;return this._setObservers.forEach(function(n,r){return t.base.event(n)[e](r)})},r}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SetSort=function(e){function n(e,t,r){var i;this.key=t,r==null&&(r="asc"),n.__super__.constructor.call(this,e),this.descending=r.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],i=this._reIndex.bind(this),this._setObserver.observerForItemAndKey=function(){return i},this._setObserver.on("itemsWereAdded",i),this._setObserver.on("itemsWereRemoved",i),this.startObserving()),this._reIndex()}return t(n,e),n.prototype.startObserving=function(){var e;return(e=this._setObserver)!=null?e.startObserving():void 0},n.prototype.stopObserving=function(){var e;return(e=this._setObserver)!=null?e.stopObserving():void 0},n.prototype.toArray=function(){return this.get("_storage")},n.prototype.forEach=function(e,t){var n,r,i,s,o,u;o=this.get("_storage"),u=[];for(r=i=0,s=o.length;i<s;r=++i)n=o[r],u.push(e.call(t,n,r,this));return u},n.prototype.compare=function(e,t){return e===t?0:e===void 0?1:t===void 0?-1:e===null?1:t===null?-1:e===!1?1:t===!1?-1:e===!0?1:t===!0?-1:e!==e?t!==t?0:1:t!==t?-1:e>t?1:e<t?-1:0},n.prototype._reIndex=function(){var e,t,n=this;return e=this.base.toArray().sort(function(e,t){var r,i,s;return i=Batman.get(e,n.key),typeof i=="function"&&(i=i.call(e)),i!=null&&(i=i.valueOf()),s=Batman.get(t,n.key),typeof s=="function"&&(s=s.call(t)),s!=null&&(s=s.valueOf()),r=n.descending?-1:1,n.compare.call(n,i,s)*r}),(t=this._setObserver)!=null&&t.startObservingItems.apply(t,e),this.set("_storage",e)},n}(Batman.SetProxy)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociationSet=function(e){function n(e,t){var r;this.foreignKeyValue=e,this.association=t,r=new Batman.Set,n.__super__.constructor.call(this,r,"hashKey")}return t(n,e),n.prototype.loaded=!1,n.prototype.load=function(e){var t=this;return this.foreignKeyValue==null?e(void 0,this):this.association.getRelatedModel().load(this._getLoadOptions(),function(n,r){return n||t.set("loaded",!0),t.fire("loaded"),e(n,t)})},n.prototype._getLoadOptions=function(){var e;return e={},e[this.association.foreignKey]=this.foreignKeyValue,e},n.accessor("loaded",Batman.Property.defaultAccessor),n}(Batman.SetSort)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicAssociationSet=function(e){function n(e,t,r){this.foreignKeyValue=e,this.foreignTypeKeyValue=t,this.association=r,n.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return t(n,e),n.prototype._getLoadOptions=function(){var e;return e={},e[this.association.foreignKey]=this.foreignKeyValue,e[this.association.foreignTypeKey]=this.foreignTypeKeyValue,e},n}(Batman.AssociationSet)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.SetIndex=function(e){function r(e,t){var i=this;this.base=e,this.key=t,r.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(){var e,t,r,s,o;t=1<=arguments.length?n.call(arguments,0):[],o=[];for(r=0,s=t.length;r<s;r++)e=t[r],o.push(i._addItem(e));return o}),this._setObserver.on("itemsWereRemoved",function(){var e,t,r,s,o;t=1<=arguments.length?n.call(arguments,0):[],o=[];for(r=0,s=t.length;r<s;r++)e=t[r],o.push(i._removeItem(e));return o})),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return t(r,e),r.accessor("toArray",function(){return this.toArray()}),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.accessor(function(e){return this._resultSetForKey(e)}),r.prototype.startObserving=function(){var e;return(e=this._setObserver)!=null?e.startObserving():void 0},r.prototype.stopObserving=function(){var e;return(e=this._setObserver)!=null?e.stopObserving():void 0},r.prototype.observerForItemAndKey=function(e,t){var n=this;return function(t,r){return n._removeItemFromKey(e,r),n._addItemToKey(e,t)}},r.prototype.forEach=function(e,t){var n=this;return this._storage.forEach(function(r,i){if(i.get("length")>0)return e.call(t,r,i,n)})},r.prototype.toArray=function(){var e;return e=[],this._storage.forEach(function(t,n){if(n.get("length")>0)return e.push(t)}),e},r.prototype._addItem=function(e){return this._addItemToKey(e,this._keyForItem(e))},r.prototype._addItemToKey=function(e,t){return this._resultSetForKey(t).add(e)},r.prototype._removeItem=function(e){return this._removeItemFromKey(e,this._keyForItem(e))},r.prototype._removeItemFromKey=function(e,t){return this._resultSetForKey(t).remove(e)},r.prototype._resultSetForKey=function(e){return this._storage.getOrSet(e,function(){return new Batman.Set})},r.prototype._keyForItem=function(e){return Batman.Keypath.forBaseAndKey(e,this.key).getValue()},r}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicAssociationSetIndex=function(e){function n(e,t,r){this.association=e,this.type=t,n.__super__.constructor.call(this,this.association.getRelatedModelForType(t).get("loaded"),r)}return t(n,e),n.prototype._resultSetForKey=function(e){var t=this;return this._storage.getOrSet(e,function(){return new Batman.PolymorphicAssociationSet(e,t.type,t.association)})},n}(Batman.SetIndex)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociationSetIndex=function(e){function n(e,t){this.association=e,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),t)}return t(n,e),n.prototype._resultSetForKey=function(e){var t=this;return this._storage.getOrSet(e,function(){return new Batman.AssociationSet(e,t.association)})},n.prototype._setResultSet=function(e,t){return this._storage.set(e,t)},n}(Batman.SetIndex)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.UniqueSetIndex=function(e){function n(){this._uniqueIndex=new Batman.Hash,n.__super__.constructor.apply(this,arguments)}return t(n,e),n.accessor(function(e){return this._uniqueIndex.get(e)}),n.prototype._addItemToKey=function(e,t){this._resultSetForKey(t).add(e);if(!this._uniqueIndex.hasKey(t))return this._uniqueIndex.set(t,e)},n.prototype._removeItemFromKey=function(e,t){var r;return r=this._resultSetForKey(t),n.__super__._removeItemFromKey.apply(this,arguments),r.isEmpty()?this._uniqueIndex.unset(t):this._uniqueIndex.set(t,r.toArray()[0])},n}(Batman.SetIndex)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.UniqueAssociationSetIndex=function(e){function n(e,t){this.association=e,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),t)}return t(n,e),n}(Batman.UniqueSetIndex)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicUniqueAssociationSetIndex=function(e){function n(e,t,r){this.association=e,this.type=t,n.__super__.constructor.call(this,this.association.getRelatedModelForType(t).get("loaded"),r)}return t(n,e),n}(Batman.UniqueSetIndex)}.call(this),function(){Batman.URI=function(){function e(e){var n,r;r=h.exec(e),n=14;while(n--)this[t[n]]=r[n]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var t,n,r,i,s,o,u,a,f,l,c,h;return h=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,t=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],e.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},e.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},e.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},e.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},e.prototype.relative=function(){var e;return e=this.queryString(),[this.path,e?"?"+e:void 0,this.hash?"#"+this.hash:void 0].join("")},e.prototype.directory=function(){var e;return e=this.path.split("/"),e.length>1?e.slice(0,e.length-1).join("/")+"/":""},e.prototype.file=function(){var e;return e=this.path.split("/"),e[e.length-1]},e.paramsFromQuery=function(e){var t,n,i,s,u,f;n={},f=e.split("&");for(s=0,u=f.length;s<u;s++)i=f[s],(t=i.match(o))?a(n,r(t[1]),r(t[2])):a(n,r(i),null);return n},e.decodeQueryComponent=r=function(e){return decodeURIComponent(e.replace(f,"%20"))},u=/^[\[\]]*([^\[\]]+)\]*(.*)/,n=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],f=/\+/g,c=/%20/g,o=/^([^=]*)=(.*)/,a=function(e,t,r){var i,s,o,f,l,c,h,p;if(!(l=t.match(u)))return;o=l[1],i=l[2];if(i==="")e[o]=r;else if(i==="[]"){(c=e[o])==null&&(e[o]=[]);if(Batman.typeOf(e[o])!=="Array")throw new Error("expected Array (got "+Batman.typeOf(e[o])+') for param "'+o+'"');e[o].push(r)}else if(l=i.match(n[0])||i.match(n[1])){s=l[1],(h=e[o])==null&&(e[o]=[]);if(Batman.typeOf(e[o])!=="Array")throw new Error("expected Array (got "+Batman.typeOf(e[o])+') for param "'+o+'"');f=e[o][e[o].length-1],Batman.typeOf(f)!=="Object"||s in f?e[o].push(a({},s,r)):a(f,s,r)}else{(p=e[o])==null&&(e[o]={});if(Batman.typeOf(e[o])!=="Object")throw new Error("expected Object (got "+Batman.typeOf(e[o])+') for param "'+o+'"');e[o]=a(e[o],i,r)}return e},e.queryFromParams=l=function(e,t){var n,r,i,o;if(e==null)return t;o=Batman.typeOf(e);if(t==null&&o!=="Object")throw new Error("value must be an Object");switch(o){case"Array":return function(){var r,s;n=[];if(e.length===0)n.push(l(null,""+t+"[]"));else for(r=0,s=e.length;r<s;r++)i=e[r],n.push(l(i,""+t+"[]"));return n}().join("&");case"Object":return function(){var n;n=[];for(r in e)i=e[r],n.push(l(i,t?""+t+"["+s(r)+"]":s(r)));return n}().join("&");default:return t!=null?""+t+"="+s(e):s(e)}},e.encodeComponent=i=function(e){return e!=null?encodeURIComponent(e):""},e.encodeQueryComponent=s=function(e){return i(e).replace(c,"+")},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Request=function(e){function n(e){var t,r,i,s;r={};for(i in e){t=e[i];if(i!=="success"&&i!=="error"&&i!=="loading"&&i!=="loaded")continue;r[i]=t,delete e[i]}n.__super__.constructor.call(this,e);for(i in r)t=r[i],this.on(i,t);((s=this.get("url"))!=null?s.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(e){if(e!=null)return this.send()})}var r;return t(n,e),n.objectToFormData=function(e){var t,n,r,i,s,o,u,a;r=function(e,t,n){var i,s,o;return n==null&&(n=!1),s=function(){switch(Batman.typeOf(t)){case"Object":return s=function(){var s;s=[];for(i in t)o=t[i],s.push(r(n?i:""+e+"["+i+"]",o));return s}(),s.reduce(function(e,t){return e.concat(t)},[]);case"Array":return t.reduce(function(t,n){return t.concat(r(""+e+"[]",n))},[]);default:return[[e,t]]}}()},t=new Batman.container.FormData,u=r("",e,!0);for(s=0,o=u.length;s<o;s++)a=u[s],n=a[0],i=a[1],t.append(n,i);return t},n.dataHasFileUploads=r=function(e){var t,n,i,s,o;if(typeof File!="undefined"&&File!==null&&e instanceof File)return!0;n=Batman.typeOf(e);switch(n){case"Object":for(t in e){i=e[t];if(r(i))return!0}break;case"Array":for(s=0,o=e.length;s<o;s++){i=e[s];if(r(i))return!0}}return!1},n.wrapAccessor("method",function(e){return{set:function(t,n){return e.set.call(this,t,n!=null?typeof n.toUpperCase=="function"?n.toUpperCase():void 0:void 0)}}}),n.prototype.method="GET",n.prototype.hasFileUploads=function(){return r(this.data)},n.prototype.contentType="application/x-www-form-urlencoded",n.prototype.autosend=!0,n.prototype.send=function(){},n}(Batman.Object)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice;Batman.Navigator=function(){function n(t){this.app=t,this.handleCurrentLocation=e(this.handleCurrentLocation,this)}return n.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},n.forApp=function(e){return new(this.defaultClass())(e)},n.prototype.start=function(){var e=this;if(typeof window=="undefined")return;if(this.started)return;return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){if(e.started&&Batman.currentApp)return e.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")})},n.prototype.stop=function(){return this.stopWatching(),this.started=!1},n.prototype.handleLocation=function(e){var t;t=this.pathFromLocation(e);if(t===this.cachedPath)return;return this.dispatch(t)},n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},n.prototype.dispatch=function(e){return this.cachedPath=this.app.get("dispatcher").dispatch(e)},n.prototype.push=function(e){var t;return t=this.dispatch(e),this.pushState(null,"",t),t},n.prototype.replace=function(e){var t;return t=this.dispatch(e),this.replaceState(null,"",t),t},n.prototype.redirect=n.prototype.push,n.prototype.normalizePath=function(){var e,n,r;return r=1<=arguments.length?t.call(arguments,0):[],r=function(){var t,i,s;s=[];for(e=t=0,i=r.length;t<i;e=++t)n=r[e],s.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return s}(),r.join("")||"/"},n.normalizePath=n.prototype.normalizePath,n}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PushStateNavigator=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.isSupported=function(){var e;return(typeof window!=="undefined"&&window!==null?(e=window.history)!=null?e.pushState:void 0:void 0)!=null},n.prototype.startWatching=function(){return Batman.addEventListener(window,"popstate",this.handleCurrentLocation)},n.prototype.stopWatching=function(){return Batman.removeEventListener(window,"popstate",this.handleCurrentLocation)},n.prototype.pushState=function(e,t,n){return window.history.pushState(e,t,this.linkTo(n))},n.prototype.replaceState=function(e,t,n){return window.history.replaceState(e,t,this.linkTo(n))},n.prototype.linkTo=function(e){return this.normalizePath(Batman.config.pathPrefix,e)},n.prototype.pathFromLocation=function(e){var t,n;return t=""+(e.pathname||"")+(e.search||""),n=new RegExp("^"+this.normalizePath(Batman.config.pathPrefix)),this.normalizePath(t.replace(n,""))},n.prototype.handleLocation=function(e){var t,r;return r=this.pathFromLocation(e),r==="/"&&(t=Batman.HashbangNavigator.prototype.pathFromLocation(e))!=="/"?this.replace(t):n.__super__.handleLocation.apply(this,arguments)},n}(Batman.Navigator)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HashbangNavigator=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.HASH_PREFIX="#!",typeof window!="undefined"&&window!==null&&"onhashchange"in window?(n.prototype.startWatching=function(){return Batman.addEventListener(window,"hashchange",this.handleCurrentLocation)},n.prototype.stopWatching=function(){return Batman.removeEventListener(window,"hashchange",this.handleCurrentLocation)}):(n.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},n.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),n.prototype.pushState=function(e,t,n){return window.location.hash=this.linkTo(n)},n.prototype.replaceState=function(e,t,n){var r;return r=window.location,r.replace(""+r.pathname+r.search+this.linkTo(n))},n.prototype.linkTo=function(e){return this.HASH_PREFIX+e},n.prototype.pathFromLocation=function(e){var t;return t=e.hash,(t!=null?t.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(t.substr(2)):"/"},n.prototype.handleLocation=function(e){var t;return Batman.config.usePushState?(t=Batman.PushStateNavigator.prototype.pathFromLocation(e),t==="/"?n.__super__.handleLocation.apply(this,arguments):e.replace(this.normalizePath(""+Batman.config.pathPrefix+this.linkTo(t)))):n.__super__.handleLocation.apply(this,arguments)},n}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function e(){this.childrenByOrder=[],this.childrenByName={}}return e.prototype.memberRoute=null,e.prototype.collectionRoute=null,e.prototype.routeForParams=function(e){var t,n,r,i;i=this.childrenByOrder;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.test(e))return t}return void 0},e.prototype.addRoute=function(e,t){var n,r,i=this;return this.childrenByOrder.push(t),e.length>0&&(r=e.split(".")).length>0?(n=r.shift(),this.childrenByName[n]||(this.childrenByName[n]=new Batman.RouteMap),this.childrenByName[n].addRoute(r.join("."),t)):t.get("member")?this.memberRoute=t:this.collectionRoute=t,!0},e}()}.call(this),function(){var e=[].slice;Batman.RouteMapBuilder=function(){function t(e,t,n,r){this.app=e,this.routeMap=t,this.parent=n,this.baseOptions=r!=null?r:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return t.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],t.ROUTES={index:{cardinality:"collection",path:function(e){return e},name:function(e){return e}},"new":{cardinality:"collection",path:function(e){return""+e+"/new"},name:function(e){return""+e+".new"}},show:{cardinality:"member",path:function(e){return""+e+"/:id"},name:function(e){return e}},edit:{cardinality:"member",path:function(e){return""+e+"/:id/edit"},name:function(e){return""+e+".edit"}},collection:{cardinality:"collection",path:function(e,t){return""+e+"/"+t},name:function(e,t){return""+e+"."+t}},member:{cardinality:"member",path:function(e,t){return""+e+"/:id/"+t},name:function(e,t){return""+e+"."+t}}},t.prototype.resources=function(){var t,n,r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;i=1<=arguments.length?e.call(arguments,0):[],v=function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++)r=i[e],typeof r=="string"&&n.push(r);return n}(),typeof i[i.length-1]=="function"&&(o=i.pop()),typeof i[i.length-1]=="object"?h=i.pop():h={},n={index:!0,"new":!0,show:!0,edit:!0};if(h.except){C=h.except;for(w=0,x=C.length;w<x;w++)c=C[w],n[c]=!1;delete h.except}else if(h.only){for(c in n)b=n[c],n[c]=!1;k=h.only;for(E=0,T=k.length;E<T;E++)c=k[E],n[c]=!0;delete h.only}for(S=0,N=v.length;S<N;S++){d=v[S],m=Batman.helpers.pluralize(d),f=Batman.helpers.camelize(m,!0),u=this._childBuilder({controller:f}),o!=null&&o.call(u);for(t in n){l=n[t];if(!l)continue;y=this.constructor.ROUTES[t],s=y.name(m),p=y.path(m),g=Batman.extend({controller:f,action:t,path:p,as:s},h),u[y.cardinality](t,g)}}return!0},t.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(e.call(arguments)))},t.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(e.call(arguments)))},t.prototype.root=function(e,t){return this.route("/",e,t)},t.prototype.route=function(e,t,n,r){return r||(typeof n=="function"?(r=n,n=void 0):typeof t=="function"&&(r=t,t=void 0)),n?t&&(n.signature=t):(typeof t=="string"?n={signature:t}:n=t,n||(n={})),r&&(n.callback=r),n.as||(n.as=this._nameFromPath(e)),n.path=e,this._addRoute(n)},t.prototype._addRoutesWithCardinality=function(){var t,n,r,i,s,o,u,f,l,c;t=arguments[0],r=3<=arguments.length?e.call(arguments,1,f=arguments.length-1):(f=1,[]),i=arguments[f++],typeof i=="string"&&(r.push(i),i={}),i=Batman.extend({},this.baseOptions,i),i[t]=!0,u=this.constructor.ROUTES[t],s=i.controller;for(l=0,c=r.length;l<c;l++)n=r[l],o=Batman.extend({action:n},i),o.path==null&&(o.path=u.path(s,n)),o.as==null&&(o.as=u.name(s,n)),this._addRoute(o);return!0},t.prototype._addRoute=function(e){var t,n,r,i;return e==null&&(e={}),r=this.rootPath+e.path,n=this.rootName+Batman.helpers.camelize(e.as,!0),delete e.as,delete e.path,t=e.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,e.app=this.app,i=new t(r,e),this.routeMap.addRoute(n,i)},t.prototype._nameFromPath=function(e){return e=e.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,""),e},t.prototype._nestingPath=function(){var e,t;return this.parent?(e=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",t=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+"/"+t+"/"+e+"/"):""},t.prototype._nestingName=function(){return this.parent?this.baseOptions.controller+".":""},t.prototype._childBuilder=function(e){return e==null&&(e={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,e)},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.App=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r,i,s,o,u,a=this;t(n,e),n.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),n.classAccessor("paramsManager",{get:function(){var e,t;if(!(e=this.get("navigator")))return;return t=this.get("currentParams"),t.replacer=new Batman.ParamsReplacer(e,t)},"final":!0}),n.classAccessor("paramsPusher",{get:function(){var e,t;if(!(e=this.get("navigator")))return;return t=this.get("currentParams"),t.pusher=new Batman.ParamsPusher(e,t)},"final":!0}),n.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),n.classAccessor("routeMap",function(){return new Batman.RouteMap}),n.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),n.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),n.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),n.classAccessor("_renderContext",function(){return Batman.RenderContext.base.descend(this)}),n.requirePath="",n.layout=void 0,u=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,i=function(e){return n[e]=function(){var t;return(t=this.get("routeMapBuilder"))[e].apply(t,arguments)}};for(s=0,o=u.length;s<o;s++)r=u[s],i(r);return n.event("ready").oneShot=!0,n.event("run").oneShot=!0,n.run=function(){var e,t,n=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),this.get("dispatcher")==null&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),this.get("navigator")==null&&(this.set("navigator",Batman.Navigator.forApp(this)),this.on("run",function(){Batman.navigator=n.get("navigator");if(Object.keys(n.get("dispatcher").routeMap).length>0)return Batman.navigator.start()})),this.observe("layout",function(e){return e!=null?e.on("ready",function(){return n.
fire("ready")}):void 0}),e=this.get("layout"),e?typeof e=="string"&&(t=this[Batman.helpers.camelize(e)+"View"]):e!==null&&(t=Batman.View),t&&(e=this.set("layout",new t({context:this,node:document}))),this.hasRun=!0,this.fire("run"),this)},n.event("ready").oneShot=!0,n.event("stop").oneShot=!0,n.stop=function(){var e;return(e=this.navigator)!=null&&e.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},n}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function e(e,t,n){var r,i,s,o;this.model=e,this.label=t,n==null&&(n={}),r={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(r,this.defaultOptions,n),i=this.encoder(),this.options.saveInline||(i.encode=!1),this.model.encode(t,i),o=this,s=function(){return o.getAccessor.call(this,o,this.model,this.label)},this.model.accessor(this.label,{get:s,set:e.defaultAccessor.set,unset:e.defaultAccessor.unset}),this.options.nestUrl&&(this.model.urlNestsUnder!=null,this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName"))))}return e.prototype.associationType="",e.prototype.isPolymorphic=!1,e.prototype.defaultOptions={saveInline:!0,autoload:!0,nestUrl:!1},e.prototype.getRelatedModel=function(){var e,t,n;return n=this.options.namespace||Batman.currentApp,e=this.options.name,t=n!=null?n[e]:void 0,t},e.prototype.getFromAttributes=function(e){return e.get("attributes."+this.label)},e.prototype.setIntoAttributes=function(e,t){return e.get("attributes").set(this.label,t)},e.prototype.encoder=function(){},e.prototype.setIndex=function(){},e.prototype.inverse=function(){var e,t,n=this;if(t=this.getRelatedModel()._batman.get("associations"))return this.options.inverseOf?t.getByLabel(this.options.inverseOf):(e=null,t.forEach(function(t,r){if(r.getRelatedModel()===n.model)return e=r}),e)},e.prototype.reset=function(){return delete this.index,!0},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PluralAssociation=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isSingular=!1,n.prototype.setForRecord=Batman.Property.wrapTrackingPrevention(function(e){var t;return(t=e.get(this.primaryKey))?this.setIndex().get(t):new Batman.AssociationSet(void 0,this)}),n.prototype.getAccessor=function(e,t,n){var r,i,s=this;if(!e.getRelatedModel())return;return(i=e.getFromAttributes(this))?i:(r=e.setForRecord(this),e.setIntoAttributes(this,r),Batman.Property.withoutTracking(function(){if(e.options.autoload&&!s.isNew()&&!r.loaded)return r.load(function(e,t){if(e)throw e})}),r)},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n}(Batman.Association)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HasManyAssociation=function(e){function n(e,t,r){if(r!=null?r.as:void 0)return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){});n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(e.get("resourceName"))+"_id"}return t(n,e),n.prototype.associationType="hasMany",n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(e,t){var n,r=this;if(!e)return(n=this.getFromAttributes(t))&&n.forEach(function(e){return e.set(r.foreignKey,t.get(r.primaryKey))}),t.set(this.label,this.setForRecord(t))},n.prototype.encoder=function(){var e;return e=this,{encode:function(t,n,r,i){var s;if(e._beingEncoded)return;e._beingEncoded=!0;if(!e.options.saveInline)return;return t!=null&&(s=[],t.forEach(function(t){var n;n=t.toJSON();if(!e.inverse()||e.inverse().options.encodeForeignKey)n[e.foreignKey]=i.get(e.primaryKey);return s.push(n)})),delete e._beingEncoded,s},decode:function(t,n,r,i,s){var o,u,f,l,c,h,p,d,v;if(h=e.getRelatedModel()){u=e.getFromAttributes(s)||e.setForRecord(s),l=u.filter(function(e){return e.isNew()}).toArray();for(d=0,v=t.length;d<v;d++)f=t[d],c=new h,c._withoutDirtyTracking(function(){return this.fromJSON(f)}),o=h.get("loaded").indexedByUnique("id").get(c.get("id")),o!=null?(o._withoutDirtyTracking(function(){return this.fromJSON(f)}),c=o):l.length>0&&(p=l.shift(),p._withoutDirtyTracking(function(){return this.fromJSON(f)}),c=p),c=h._mapIdentity(c),u.add(c),e.options.inverseOf&&c.set(e.options.inverseOf,s);u.set("loaded",!0)}return u}}},n}(Batman.PluralAssociation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicHasManyAssociation=function(e){function n(e,t,r){r.inverseOf=this.foreignLabel=r.as,delete r.as,r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id"),n.__super__.constructor.call(this,e,t,r),this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return t(n,e),n.prototype.isPolymorphic=!0,n.prototype.apply=function(e,t){var r,i=this;return!e&&(r=this.getFromAttributes(t))&&(n.__super__.apply.apply(this,arguments),r.forEach(function(e){return e.set(i.foreignTypeKey,i.modelType())})),!0},n.prototype.getRelatedModelForType=function(){return this.getRelatedModel()},n.prototype.modelType=function(){return this.model.get("resourceName")},n.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},n.prototype.encoder=function(){var e,t;return e=this,t=n.__super__.encoder.apply(this,arguments),t.encode=function(t,n,r,i){var s;if(e._beingEncoded)return;e._beingEncoded=!0;if(!e.options.saveInline)return;return t!=null&&(s=[],t.forEach(function(t){var n;return n=t.toJSON(),n[e.foreignKey]=i.get(e.primaryKey),n[e.foreignTypeKey]=e.modelType(),s.push(n)})),delete e._beingEncoded,s},t},n}(Batman.HasManyAssociation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SingularAssociation=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isSingular=!0,n.prototype.getAccessor=function(e,t,n){var r,i;if(i=e.getFromAttributes(this))return i;if(e.getRelatedModel())return r=this.associationProxy(e),Batman.Property.withoutTracking(function(){if(!r.get("loaded")&&e.options.autoload)return r.load()}),r},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n}(Batman.Association)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HasOneAssociation=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return t(n,e),n.prototype.associationType="hasOne",n.prototype.proxyClass=Batman.HasOneProxy,n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(e,t){var n;if(n=this.getFromAttributes(t))return n.set(this.foreignKey,t.get(this.primaryKey))},n.prototype.encoder=function(){var e;return e=this,{encode:function(t,n,r,i){var s;if(!e.options.saveInline)return;if(s=t.toJSON())s[e.foreignKey]=i.get(e.primaryKey);return s},decode:function(t,n,r,i,s){var o,u;return u=e.getRelatedModel(),o=new u,o._withoutDirtyTracking(function(){return this.fromJSON(t)}),e.options.inverseOf&&o.set(e.options.inverseOf,s),o=u._mapIdentity(o),o}}},n}(Batman.SingularAssociation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.BelongsToAssociation=function(e){function n(e,t,r){if(r!=null?r.polymorphic:void 0)return delete r.polymorphic,function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){});n.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey)}return t(n,e),n.prototype.associationType="belongsTo",n.prototype.proxyClass=Batman.BelongsToProxy,n.prototype.indexRelatedModelOn="primaryKey",n.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},n.prototype.encoder=function(){var e,t;return e=this,t={encode:!1,decode:function(t,n,r,i,s){var o,u,f;return f=e.getRelatedModel(),u=new f,u._withoutDirtyTracking(function(){return this.fromJSON(t)}),u=f._mapIdentity(u),e.options.inverseOf&&(o=e.inverse())&&(o instanceof Batman.HasManyAssociation?s.set(e.foreignKey,u.get(e.primaryKey)):u.set(o.label,s)),s.set(e.label,u),u}},this.options.saveInline&&(t.encode=function(e){return e.toJSON()}),t},n.prototype.apply=function(e){var t,n;if(n=e.get(this.label)){t=n.get(this.primaryKey);if(t!==void 0)return e.set(this.foreignKey,t)}},n}(Batman.SingularAssociation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicBelongsToAssociation=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return t(n,e),n.prototype.isPolymorphic=!0,n.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,n.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),n.prototype.getRelatedModel=!1,n.prototype.setIndex=!1,n.prototype.inverse=!1,n.prototype.apply=function(e){var t,r,i;n.__super__.apply.apply(this,arguments);if(r=e.get(this.label))return r instanceof Batman.AssociationProxy?i=r.association.model:i=r.constructor,t=i.get("resourceName"),e.set(this.foreignTypeKey,t)},n.prototype.getAccessor=function(e,t,n){var r,i;if(i=e.getFromAttributes(this))return i;if(e.getRelatedModelForType(this.get(e.foreignTypeKey)))return r=this.associationProxy(e),Batman.Property.withoutTracking(function(){if(!r.get("loaded")&&e.options.autoload)return r.load()}),r},n.prototype.url=function(e){var t,n,r,i,s,o,u,a;o=(u=e.data)!=null?u[this.foreignTypeKey]:void 0;if(o&&(i=this.inverseForType(o)))return s=Batman.helpers.pluralize(o).toLowerCase(),r=(a=e.data)!=null?a[this.foreignKey]:void 0,n=i.isSingular?"singularize":"pluralize",t=Batman.helpers[n](i.label),"/"+s+"/"+r+"/"+t},n.prototype.getRelatedModelForType=function(e){var t,n;return n=this.options.namespace||Batman.currentApp,e&&(t=n!=null?n[e]:void 0,t||(t=n!=null?n[Batman.helpers.camelize(e)]:void 0)),t},n.prototype.setIndexForType=function(e){var t;return(t=this.typeIndicies)[e]||(t[e]=new Batman.PolymorphicUniqueAssociationSetIndex(this,e,this.primaryKey)),this.typeIndicies[e]},n.prototype.inverseForType=function(e){var t,n,r,i=this;if(n=(r=this.getRelatedModelForType(e))!=null?r._batman.get("associations"):void 0)return this.options.inverseOf?n.getByLabel(this.options.inverseOf):(t=null,n.forEach(function(e,n){if(n.getRelatedModel()===i.model)return t=n}),t)},n.prototype.encoder=function(){var e,t;return e=this,t={encode:!1,decode:function(t,n,r,i,s){var o,u,f,l;return o=r[e.foreignTypeKey]||s.get(e.foreignTypeKey),l=e.getRelatedModelForType(o),f=new l,f._withoutDirtyTracking(function(){return this.fromJSON(t)}),f=l._mapIdentity(f),e.options.inverseOf&&(u=e.inverseForType(o))&&(u instanceof Batman.PolymorphicHasManyAssociation?(s.set(e.foreignKey,f.get(e.primaryKey)),s.set(e.foreignTypeKey,o)):f.set(u.label,s)),s.set(e.label,f),f}},this.options.saveInline&&(t.encode=function(e){return e.toJSON()}),t},n}(Batman.BelongsToAssociation)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.Validator=function(e){function r(){var e,t;t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],this.options=t,r.__super__.constructor.apply(this,e)}return t(r,e),r.prototype.validate=function(e){},r.prototype.format=function(e,t,n){return Batman.t("errors.messages."+t,n)},r.options=function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],Batman.initializeObject(this),this._batman.options?this._batman.options.concat(e):this._batman.options=e},r.matches=function(e){var t,n,r,i,s,o;n={},r=!1;for(t in e)i=e[t],~((s=this._batman)!=null?(o=s.options)!=null?o.indexOf(t):void 0:void 0)&&(n[t]=i,r=!0);if(r)return n},r}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",not_matching:"is not valid"}}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.RegExpValidator=function(e){function n(e){var t;this.regexp=(t=e.regexp)!=null?t:e.pattern,n.__super__.constructor.apply(this,arguments)}return t(n,e),n.options("regexp","pattern"),n.prototype.validateEach=function(e,t,n,r){var i;return i=t.get(n),i!=null&&i!==""&&(this.regexp.test(i)||e.add(n,this.format(n,"not_matching"))),r()},n}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PresenceValidator=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.options("presence"),n.prototype.validateEach=function(e,t,n,r){var i;return i=t.get(n),this.options.presence&&(i==null||i==="")&&e.add(n,this.format(n,"blank")),r()},n}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.NumericValidator=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.options("numeric"),n.prototype.validateEach=function(e,t,n,r){var i;return i=t.get(n),this.options.numeric&&isNaN(parseFloat(i))&&e.add(n,this.format(n,"not_numeric")),r()},n}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.LengthValidator=function(e){function n(e){var t;if(t=e.lengthIn||e.lengthWithin)e.minLength=t[0],e.maxLength=t[1]||-1,delete e.lengthWithin,delete e.lengthIn;n.__super__.constructor.apply(this,arguments)}return t(n,e),n.options("minLength","maxLength","length","lengthWithin","lengthIn"),n.prototype.validateEach=function(e,t,n,r){var i,s,o;return i=this.options,s=(o=t.get(n))!=null?o:[],i.minLength&&s.length<i.minLength&&e.add(n,this.format(n,"too_short",{count:i.minLength})),i.maxLength&&s.length>i.maxLength&&e.add(n,this.format(n,"too_long",{count:i.maxLength})),i.length&&s.length!==i.length&&e.add(n,this.format(n,"wrong_length",{count:i.length})),r()},n}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ControllerActionFrame=function(e){function n(e,t){n.__super__.constructor.call(this,e),this.on("complete",t)}return t(n,e),n.prototype.operationOccurred=!1,n.prototype.remainingOperations=0,n.prototype.event("complete").oneShot=!0,n.prototype.startOperation=function(e){return e==null&&(e={}),e.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},n.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},n.prototype.startAndFinishOperation=function(e){return this.startOperation(e),this.finishOperation(e),!0},n.prototype._changeOperationsCounter=function(e){var t;this.remainingOperations+=e,this.remainingOperations===0&&this.fire("complete"),(t=this.parentFrame)!=null&&t._changeOperationsCounter(e)},n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.InsertionBinding=function(e){function n(e,t,r,i,s,o){var u,a=this;this.invert=o!=null?o:!1,this.placeholderNode=document.createComment("detached node "+this.get("_batmanID")),u=n.__super__.constructor.apply(this,arguments),Batman.DOM.onParseExit(this.node,function(){a.bind();if(a.placeholderNode!=null)return Batman.DOM.trackBinding(a,a.placeholderNode)}),u}return t(n,e),n.prototype.isTwoWay=!1,n.prototype.bindImmediately=!1,n.prototype.dataChange=function(e){var t;t=this.placeholderNode.parentNode||this.node.parentNode;if(!!e!=!this.invert)return t.insertBefore(this.placeholderNode,this.node),Batman.DOM.removeNode(this.node);if(this.node.parentNode==null)return Batman.DOM.insertBefore(t,this.node,this.placeholderNode),t.removeChild(this.placeholderNode)},n.prototype.die=function(){if(this.dead)return;return n.__super__.die.apply(this,arguments),!!this.get("filteredValue")==!this.invert?Batman.DOM.destroyNode(this.placeholderNode):Batman.DOM.destroyNode(this.node)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var e;e=function(e){var t;for(t in e)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var e;try{return e=document.createElement("div"),delete e.test}catch(t){return Batman.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return t=t.nodeType?Batman.cache[t[Batman.expando]]:t[Batman.expando],!!t&&!e(t)},data:function(e,t,n,r){var i,s,o,u,a,f;if(!Batman.acceptData(e))return;u=Batman.expando,s=typeof t=="string",i=Batman.cache,o=e[Batman.expando];if((!o||r&&o&&i[o]&&!i[o][u])&&s&&n===void 0)return;o||(e.nodeType!==3?e[Batman.expando]=o=++Batman.uuid:o=Batman.expando),i[o]||(i[o]={});if(typeof t=="object"||typeof t=="function")r?i[o][u]=Batman.extend(i[o][u],t):i[o]=Batman.extend(i[o],t);return f=i[o],r&&(f[u]||(f[u]={}),f=f[u]),n!==void 0&&(f[t]=n),s?a=f[t]:a=f,a},removeData:function(t,n,r){var i,s,o,u,f,l;if(!Batman.acceptData(t))return;u=Batman.expando,f=t.nodeType,i=Batman.cache,s=t[Batman.expando];if(!i[s])return;if(n){l=r?i[s][u]:i[s];if(l){delete l[n];if(!e(l))return}}if(r){delete i[s][u];if(!e(i[s]))return}return o=i[s][u],Batman.canDeleteExpando||!i.setInterval?delete i[s]:i[s]=null,o?(i[s]={},i[s][u]=o):Batman.canDeleteExpando?delete t[Batman.expando]:t.removeAttribute?t.removeAttribute(Batman.expando):t[Batman.expando]=null},_data:function(e,t,n){return Batman.data(e,t,n,!0)},acceptData:function(e){var t;if(e.nodeName){t=Batman.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}})}.call(this),function(){var e,t,n=[].slice;e=function(e){return function(t){return typeof t=="undefined"?void 0:e.apply(this,arguments)}},t=function(e,t){return e||t},Batman.Filters={raw:e(function(e,t){return t.escapeValue=!1,e}),get:e(function(e,t){return e.get!=null?e.get(t):e[t]}),equals:e(function(e,t,n){return e===t}),and:function(e,t){return e&&t},or:function(e,t,n){return e||t},not:function(e,t){return!e},matches:e(function(e,t){return e.indexOf(t)!==-1}),truncate:e(function(e,t,n,r){return n==null&&(n="..."),r||(r=n,n="..."),e.length>t&&(e=e.substr(0,t-n.length)+n),e}),"default":function(e,t,n){return e!=null&&e!==""?e:t},prepend:function(e,t,n){return t+e},append:function(e,t,n){return e+t},replace:e(function(e,t,n,r,i){return i||(i=r,r=void 0),r===void 0?e.replace(t,n):e.replace(t,n,r)}),downcase:e(function(e){return e.toLowerCase()}),upcase:e(function(e){return e.toUpperCase()}),pluralize:e(function(e,t,n,r){return r||(r=n,n=!0,r||(r=t,t=void 0)),t?Batman.helpers.pluralize(t,e,void 0,n):Batman.helpers.pluralize(e)}),humanize:e(function(e,t){return Batman.helpers.humanize(e)}),join:e(function(e,t,n){return t==null&&(t=""),n||(n=t,t=""),e.join(t)}),sort:e(function(e){return e.sort()}),map:e(function(e,t){return e.map(function(e){return Batman.get(e,t)})}),has:function(e,t){return e==null?!1:Batman.contains(e,t)},first:e(function(e){return e[0]}),meta:e(function(e,t){return e.meta.get(t)}),interpolate:function(e,t,n){var r,i,s;n||(n=t,t=void 0);if(!e)return;s={};for(r in t)i=t[r],s[r]=this.get(i),s[r]==null&&(s[r]="");return Batman.helpers.interpolate(e,s)},withArguments:function(){var e,t,r,i;t=arguments[0],r=3<=arguments.length?n.call(arguments,1,i=arguments.length-1):(i=1,[]),e=arguments[i++];if(!t)return;return function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],t.call.apply(t,[this].concat(n.call(r),n.call(e)))}},routeToAction:e(function(e,t){var n;return n=Batman.Dispatcher.paramsFromArgument(e),n.action=t,n}),escape:e(Batman.escapeHTML)},function(){var t,n,r,i,s;i=["capitalize","singularize","underscore","camelize"],s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(Batman.Filters[t]=e(Batman.helpers[t]));return s}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.RenderContext=function(){function e(e,t){this.object=e,this.parent=t}var n;return e.deProxy=function(e){return e!=null&&e.isContextProxy?e.get("proxiedObject"):e},e.root=function(){var e;return Batman.currentApp!=null&&(e=Batman.currentApp.get("_renderContext")),e!=null?e:e=this.base},e.prototype.windowWrapper={window:Batman.container},e.prototype.findKey=function(e){var t,n,r;t=e.split(".")[0].split("|")[0].trim(),n=this;while(n){r=Batman.get(n.object,t);if(typeof r!="undefined")return r=Batman.get(n.object,e),[r,n.object].map(this.constructor.deProxy);n=n.parent}return[Batman.get(this.windowWrapper,e),this.windowWrapper]},e.prototype.get=function(e){return this.findKey(e)[0]},e.prototype.contextForKey=function(e){return this.findKey(e)[1]},e.prototype.descend=function(e,t){var n;return t&&(n=e,e=new Batman.Object,e[t]=n),new this.constructor(e,this)},e.prototype.descendWithKey=function(e,t){var r;return r=new n(this,e),this.descend(r,t)},e.prototype.chain=function(){var e,t;t=[],e=this;while(e)t.push(e.object),e=e.parent;return t},e.ContextProxy=n=function(e){function n(e,t,n){this.renderContext=e,this.keyPath=t,this.localKey=n,this.binding=new Batman.DOM.AbstractBinding(void 0,this.keyPath,this.renderContext)}return t(n,e),n.prototype.isContextProxy=!0,n.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),n.accessor({get:function(e){return this.get("proxiedObject."+e)},set:function(e,t){return this.set("proxiedObject."+e,t)},unset:function(e){return this.unset("proxiedObject."+e)}}),n}(Batman.Object),e}.call(this),Batman.RenderContext.base=new Batman.RenderContext(Batman.RenderContext.prototype.windowWrapper)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ViewStore=function(e){function n(){n.__super__.constructor.apply(this,arguments),this._viewContents={},this._requestedPaths=new Batman.SimpleSet}return t(n,e),n.prefix="views",n.fetchFromRemote=!0,n.prototype.propertyClass=Batman.Property,n.prototype.fetchView=function(e){var t=this;return new Batman.Request({url:Batman.Navigator.normalizePath(this.constructor.prefix,""+e+".html"),type:"html",success:function(n){return t.set(e,n)},error:function(t){throw new Error("Could not load view from "+e)}})},n.accessor({"final":!0,get:function(e){var t;if(e[0]!=="/")return this.get("/"+e);if(this._viewContents[e])return this._viewContents[e];if(this._requestedPaths.has(e))return;if(t=this._sourceFromDOM(e))return t;if(!this.constructor.fetchFromRemote)throw new Error("Couldn't find view source for '"+e+"'!");this.fetchView(e)},set:function(e,t){return e[0]!=="/"?this.set("/"+e,t):(this._requestedPaths.add(e),this._viewContents[e]=t)}}),n.prototype.prefetch=function(e){return this.get(e),!0},n.prototype._sourceFromDOM=function(e){var t,n;n=e.slice(1);if(t=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']"))return Batman.setImmediate(function(){var e;return(e=t.parentNode)!=null?e.removeChild(t):void 0}),Batman.DOM.defineView(e,t)},n}(Batman.Object)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Batman.View=function(e){function r(e){var t,n=this;e==null&&(e={}),t=e.context,t?t instanceof Batman.RenderContext||(t=Batman.RenderContext.root().descend(t)):t=Batman.RenderContext.root(),e.context=t.descend(this),r.__super__.constructor.call(this,e),Batman.Property.withoutTracking(function(){var e;return(e=n.get("node"))?n.render(e):n.observeOnce("node",function(e){return n.render(e)})})}return t(r,e),r.store=new Batman.ViewStore,r.option=function(){var e,t=this;return e=1<=arguments.length?n.call(arguments,0):[],e.forEach(function(e){return t.accessor(t.prototype._argumentBindingKey(e),function(t){var n,r,i,s;if(!(i=this.get("node"))||!(n=this.get("context")))return;r=i.getAttribute(("data-view-"+e).toLowerCase());if(r==null)return;return(s=this[t])!=null&&s.die(),this[t]=new Batman.DOM.ViewArgumentBinding(i,r,n)})}),this.accessor.apply(this,n.call(e).concat([function(e){var t;return(t=this.get(this._argumentBindingKey(e)))!=null?t.get("filteredValue"):void 0}]))},r.prototype.isView=!0,r.prototype.cache=!0,r.prototype._rendered=!1,r.prototype.source="",r.prototype.html="",r.prototype.node=null,r.prototype.event("ready").oneShot=!0,r.accessor("html",{get:function(){var e;if(this.html&&this.html.length>0)return this.html;if(!(e=this.get("source")))return;return e=Batman.Navigator.normalizePath(e),this.html=this.constructor.store.get(e)},set:function(e,t){return this.html=t}}),r.accessor("node",{get:function(){var e;if(this.node==null){e=this.get("html");if(!(e&&e.length>0))return;this.node=document.createElement("div"),this._setNodeOwner(this.node),Batman.setInnerHTML(this.node,e)}return this.node},set:function(e,t){var n,r=this;return this.node=t,this._setNodeOwner(t),n=function(e){if(e!=null)return Batman.setInnerHTML(r.node,e),r.forget("html",n)},this.observeAndFire("html",n),t}}),r.YieldStorage=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.wrapAccessor(function(e){return{get:function(t){var n;return n=e.get.call(this,t),n==null&&(n=this.set(t,[])),n}}}),n}(Batman.Hash),r.accessor("yields",function(){return new this.constructor.YieldStorage}),r.prototype.render=function(e){var t=this;if(this._rendered)return;this._rendered=!0,this.event("ready").resetOneShot();if(e)return this._renderer=new Batman.Renderer(e,this.context,this),this._renderer.on("rendered",function(){return t.fire("ready",e)})},r.prototype.isInDOM=function(){var e;return(e=this.get("node"))?e.parentNode!=null||this.get("yields").some(function(t,n){var r,i;for(r=0,i=n.length;r<i;r++){e=n[r].node;if(e.parentNode!=null)return!0}return!1}):!1},r.prototype.applyYields=function(){return this.get("yields").forEach(function(e,t){var n,r,i,s,o,u,a;i=Batman.DOM.Yield.withName(e),a=[];for(s=0,o=t.length;s<o;s++)u=t[s],r=u.node,n=u.action,a.push(i[n](r));return a})},r.prototype.retractYields=function(){return this.get("yields").forEach(function(e,t){var n,r,i,s,o;o=[];for(r=0,i=t.length;r<i;r++)n=t[r].node,o.push((s=n.parentNode)!=null?s.removeChild(n):void 0);return o})},r.prototype.pushYieldAction=function(e,t,n){return this._setNodeYielder(n),this.get("yields").get(e).push({node:n,action:t})},r.prototype._argumentBindingKey=function(e){return"_"+e+"ArgumentBinding"},r.prototype._setNodeOwner=function(e){return Batman._data(e,"view",this)},r.prototype._setNodeYielder=function(e){return Batman._data(e,"yielder",this)},r.prototype.on("ready",function(){return typeof this.ready=="function"?this.ready.apply(this,arguments):void 0}),r.prototype.on("appear",function(){return typeof this.viewDidAppear=="function"?this.viewDidAppear.apply(this,arguments):void 0}),r.prototype.on("disappear",function(){return typeof this.viewDidDisappear=="function"?this.viewDidDisappear.apply(this,arguments):void 0}),r.prototype.on("beforeAppear",function(){return typeof this.viewWillAppear=="function"?this.viewWillAppear.apply(this,arguments):void 0}),r.prototype.on("beforeDisappear",function(){return typeof this.viewWillDisappear=="function"?this.viewWillDisappear.apply(this,arguments):void 0}),r}.call(this,Batman.Object)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;Batman.DOM.Yield=e=function(e){function t(){this.cycle()}return n(t,e),t.yields={},t.queued=function(e){return function(){var t,n,i=this;return t=1<=arguments.length?r.call(arguments,0):[],this.containerNode!=null?e.apply(this,t):n=this.observe("containerNode",function(){var r;return r=e.apply(i,t),i.forget("containerNode",n),r})}},t.reset=function(){return this.yields={}},t.withName=function(e){var t;return(t=this.yields)[e]||(t[e]=new this({name:e})),this.yields[e]},t.forEach=function(e){var t,n,r;r=this.yields;for(t in r)n=r[t],e(n)},t.clearAll=function(){return this.forEach(function(e){return e.clear()})},t.cycleAll=function(){return this.forEach(function(e){return e.cycle()})},t.clearAllStale=function(){return this.forEach(function(e){return e.clearStale()})},t.prototype.cycle=function(){return this.currentVersionNodes=[]},t.prototype.clear=t.queued(function(){var e,t,n,r,i;this.cycle(),r=function(){var t,n,r,i;r=this.containerNode.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e);return i}.call(this),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(Batman.removeOrDestroyNode(e));return i}),t.prototype.clearStale=t.queued(function(){var e,t,n,r,i;r=function(){var t,n,r,i;r=this.containerNode.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e);return i}.call(this),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],~this.currentVersionNodes.indexOf(e)||i.push(Batman.removeOrDestroyNode(e));return i}),t.prototype.append=t.queued(function(e){return this.currentVersionNodes.push(e),Batman.appendChild(this.containerNode,e,!0)}),t.prototype.replace=t.queued(function(e){return this.clear(),this.append(e)}),t}(Batman.Object)}.call(this),function(){}.call(this),function(){!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"
],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest});var prefixes;(typeof exports!="undefined"&&exports!==null?exports:this).reqwest=typeof window!="undefined"&&window!==null?window.reqwest:reqwest,Batman.Request.prototype._parseResponseHeaders=function(e){var t;return t=e.getAllResponseHeaders().split("\n").reduce(function(e,t){var n,r,i;if(r=t.match(/([^:]*):\s*(.*)/))n=r[1],i=r[2],e[n]=i;return e},{})},Batman.Request.prototype.send=function(e){var t,n,r,i=this;return e==null&&(e=this.get("data")),this.fire("loading"),t={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:function(e){return i.mixin({xhr:n,response:e,status:typeof n!="undefined"&&n!==null?n.status:void 0,responseHeaders:i._parseResponseHeaders(n)}),i.fire("success",e)},error:function(e){return i.mixin({xhr:e,response:e.responseText||e.content,status:e.status,responseHeaders:i._parseResponseHeaders(e)}),e.request=i,i.fire("error",e)},complete:function(){return i.fire("loaded")}},(r=t.method)==="PUT"||r==="POST"?this.hasFileUploads()?t.data=this.constructor.objectToFormData(e):(t.contentType=this.get("contentType"),t.data=Batman.URI.queryFromParams(e)):t.data=e,n=reqwest(t).request},prefixes=["Webkit","Moz","O","ms",""],Batman.mixins.animation={initialize:function(){var e,t,n;for(t=0,n=prefixes.length;t<n;t++)e=prefixes[t],this.style[""+e+"Transform"]="scale(1, 1)",this.style.opacity=1,this.style[""+e+"TransitionProperty"]=""+(e?"-"+e.toLowerCase()+"-":"")+"transform, opacity",this.style[""+e+"TransitionDuration"]="0.8s, 0.55s",this.style[""+e+"TransformOrigin"]="left top";return this},show:function(e){var t,n,r,i=this;return t=function(){var e,t,n;i.style.opacity=1;for(t=0,n=prefixes.length;t<n;t++)e=prefixes[t],i.style[""+e+"Transform"]="scale(1, 1)";return i},e?((n=e.append)!=null&&n.appendChild(this),(r=e.before)!=null&&r.parentNode.insertBefore(this,e.before),setTimeout(t,0)):t(),this},hide:function(e){var t,n,r,i=this;this.style.opacity=0;for(n=0,r=prefixes.length;n<r;n++)t=prefixes[n],this.style[""+t+"Transform"]="scale(0, 0)";return e&&setTimeout(function(){var e;return(e=i.parentNode)!=null?e.removeChild(i):void 0},600),this}}}.call(this),function(){}.call(this);