/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * License: MIT
 * Author: Miller Medeiros
 * Version: 0.9.0 (2012/5/28 23:9)
 */(function(e){e(["signals"],function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1}function n(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function r(e){return n(e,"RegExp")}function i(e){return n(e,"Array")}function s(e){return typeof e=="function"}function o(e){var t;return e===null||e==="null"?t=null:e==="true"?t=!0:e==="false"?t=!1:e===h||e==="undefined"?t=h:e===""||isNaN(e)?t=e:t=parseFloat(e),t}function u(e){var t=e.length,n=[];while(t--)n[t]=o(e[t]);return n}function a(e){var t=(e||"").replace("?","").split("&"),n=t.length,r={},i,s;while(n--)i=t[n].split("="),s=o(i[1]),r[i[0]]=typeof s=="string"?decodeURIComponent(s):s;return r}function f(){this._routes=[],this._prevRoutes=[],this.bypassed=new e.Signal,this.routed=new e.Signal}function l(t,n,i,s){var o=r(t),u=c.patternLexer;this._router=s,this._pattern=t,this._paramsIds=o?null:u.getParamIds(this._pattern),this._optionalParamsIds=o?null:u.getOptionalParamsIds(this._pattern),this._matchRegexp=o?t:u.compilePattern(t),this.matched=new e.Signal,this.switched=new e.Signal,n&&this.matched.add(n),this._priority=i||0}var c,h;return f.prototype={greedy:!1,greedyEnabled:!0,normalizeFn:null,create:function(){return new f},shouldTypecast:!1,addRoute:function(e,t,n){var r=new l(e,t,n,this);return this._sortedInsert(r),r},removeRoute:function(e){var n=t(this._routes,e);n!==-1&&this._routes.splice(n,1),e._destroy()},removeAllRoutes:function(){var e=this.getNumRoutes();while(e--)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){e=e||"",t=t||[];var n=this._getMatchedRoutes(e),r=0,i=n.length,s;if(i){this._notifyPrevRoutes(n,e),this._prevRoutes=n;while(r<i)s=n[r],s.route.matched.dispatch.apply(s.route.matched,t.concat(s.params)),s.isFirst=!r,this.routed.dispatch.apply(this.routed,t.concat([e,s])),r+=1}else this.bypassed.dispatch.apply(this.bypassed,t.concat([e]))},_notifyPrevRoutes:function(e,t){var n=0,r;while(r=this._prevRoutes[n++])r.route.switched&&this._didSwitch(r.route,e)&&r.route.switched.dispatch(t)},_didSwitch:function(e,t){var n,r=0;while(n=t[r++])if(n.route===e)return!1;return!0},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,n=t.length;do--n;while(t[n]&&e._priority<=t[n]._priority);t.splice(n+1,0,e)},_getMatchedRoutes:function(e){var t=[],n=this._routes,r=n.length,i;while(i=n[--r]){(!t.length||this.greedy||i.greedy)&&i.match(e)&&t.push({route:i,params:i._getParamsArray(e)});if(!this.greedyEnabled&&t.length)break}return t},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},c=new f,c.VERSION="0.9.0",c.NORM_AS_ARRAY=function(e,t){return[t.vals_]},c.NORM_AS_OBJECT=function(e,t){return[t]},l.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t=this.rules,n=this._getParamsObject(e),r;for(r in t)if(r!=="normalize_"&&t.hasOwnProperty(r)&&!this._isValidParam(e,r,n))return!1;return!0},_isValidParam:function(e,n,o){var u=this.rules[n],a=o[n],f=!1,l=n.indexOf("?")===0;return a==null&&this._optionalParamsIds&&t(this._optionalParamsIds,n)!==-1?f=!0:r(u)?(l&&(a=o[n+"_"]),f=u.test(a)):i(u)?(l&&(a=o[n+"_"]),f=t(u,a)!==-1):s(u)&&(f=u(a,e,o)),f},_getParamsObject:function(e){var t=this._router.shouldTypecast,n=c.patternLexer.getParamValues(e,this._matchRegexp,t),r={},i=n.length,s,u;while(i--)u=n[i],this._paramsIds&&(s=this._paramsIds[i],s.indexOf("?")===0&&u&&(r[s+"_"]=u,u=a(u),n[i]=u),r[s]=u),r[i]=u;return r.request_=t?o(e):e,r.vals_=n,r},_getParamsArray:function(e){var t=this.rules?this.rules.normalize_:null,n;return t=t||this._router.normalizeFn,t&&s(t)?n=t(e,this._getParamsObject(e)):n=this._getParamsObject(e).vals_,n},interpolate:function(e){var t=c.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},c.patternLexer=function(){function e(){var e,t;for(e in p)p.hasOwnProperty(e)&&(t=p[e],t.id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function t(e,t){var n=[],r;while(r=e.exec(t))n.push(r[1]);return n}function n(e){return t(h,e)}function r(e){return t(p.OP.rgx,e)}function i(e){return e=e||"",e&&(g===d?e=e.replace(l,""):g===m&&(e=e.replace(c,"")),e=s(e,"rgx","save"),e=e.replace(f,"\\$&"),e=s(e,"rRestore","res"),g===d&&(e="\\/?"+e)),g!==v&&(e+="\\/?"),new RegExp("^"+e+"$")}function s(e,t,n){var r,i;for(i in p)p.hasOwnProperty(i)&&(r=p[i],e=e.replace(r[t],r[n]));return e}function o(e,t,n){var r=t.exec(e);return r&&(r.shift(),n&&(r=u(r))),r}function a(e,t){if(typeof e!="string")throw new Error("Route pattern should be a string.");var n=function(e,n){var r;if(n in t){r=t[n];if(e.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+e+'".')}else{if(e.indexOf("{")!==-1)throw new Error("The segment "+e+" is required.");r=""}return r};return p.OS.trail||(p.OS.trail=new RegExp("(?:"+p.OS.id+")+$")),e.replace(p.OS.rgx,p.OS.save).replace(h,n).replace(p.OS.trail,"").replace(p.OS.rRestore,"/")}var f=/[\\.+*?\^$\[\](){}\/'#]/g,l=/^\/|\/$/g,c=/\/$/g,h=/(?:\{|:)([^}:]+)(?:\}|:)/g,p={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},d=1,v=2,m=3,g=d;return e(),{strict:function(){g=v},loose:function(){g=d},legacy:function(){g=m},getParamIds:n,getOptionalParamsIds:r,getParamValues:o,compilePattern:i,interpolate:a}}(),c})})(typeof define=="function"&&define.amd?define:function(e,t){typeof module!="undefined"&&module.exports?module.exports=t(require(e[0])):window.crossroads=t(window[e[0]])});